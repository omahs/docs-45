<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-adrs/0004-runtime-governance">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">ADR 0004: Runtime Governance | Oasis Network Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.oasis.io/adrs/0004-runtime-governance"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="ADR 0004: Runtime Governance | Oasis Network Documentation"><meta data-rh="true" name="description" content="Component"><meta data-rh="true" property="og:description" content="Component"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.oasis.io/adrs/0004-runtime-governance"><link data-rh="true" rel="alternate" href="https://docs.oasis.io/adrs/0004-runtime-governance" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.oasis.io/adrs/0004-runtime-governance" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.03bfe953.css">
<link rel="preload" href="/assets/js/runtime~main.df39c847.js" as="script">
<link rel="preload" href="/assets/js/main.4ff8f277.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="OPF Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="OPF Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Oasis Docs</b></a><a class="navbar__item navbar__link" href="/general/">Use Oasis</a><a class="navbar__item navbar__link" href="/get-involved/">Get Involved</a><a class="navbar__item navbar__link" href="/node/">Run Node</a><a class="navbar__item navbar__link" href="/dapp/">Create dApp</a><a class="navbar__item navbar__link" href="/paratime/">Build ParaTime</a><a class="navbar__item navbar__link" href="/core/">Develop Core</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/oasisprotocol" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" title="GitHub repository" aria-label="GitHub repository"></a><a href="https://oasisprotocol.org/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-www-link" title="Oasis Protocol Foundation website" aria-label="Oasis Protocol Foundation website"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_Pkmr"><kbd class="searchHint_iIMx">ctrl</kbd><kbd class="searchHint_iIMx">K</kbd></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/adrs">Architectural Decision Records</a><button aria-label="Toggle the collapsible sidebar category &#x27;Architectural Decision Records&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0001-tm-multi-root-apphash">ADR 0001: Multiple Roots Under the Tendermint Application Hash</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0002-go-modules-compatible-git-tags">ADR 0002: Go Modules Compatible Git Tags</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0003-consensus-runtime-token-transfer">ADR 0003: Consensus/Runtime Token Transfer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/adrs/0004-runtime-governance">ADR 0004: Runtime Governance</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0005-runtime-compute-slashing">ADR 0005: Runtime Compute Node Slashing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0006-consensus-governance">ADR 0006: Consensus Governance</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0007-improved-random-beacon">ADR 0007: Improved Random Beacon</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0008-standard-account-key-generation">ADR 0008: Standard Account Key Generation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0009-ed25519-semantics">ADR 0009: Ed25519 Signature Verification Semantics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0010-vrf-elections">ADR 0010: VRF-based Committee Elections</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0011-incoming-runtime-messages">ADR 0011: Incoming Runtime Messages</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0012-runtime-message-results">ADR 0012: Runtime Message Results</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0013-runtime-upgrades">ADR 0013: Runtime Upgrade Improvements</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0014-runtime-signing-tx-with-hardware-wallet">ADR 0014: Signing Runtime Transactions with Hardware Wallet</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0015-vrf-per-block-entropy">ADR 0015: Randomized Paratime Proposer Selection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0016-consensus-parameters-change-proposal">ADR 0016: Consensus Parameters Change Proposal</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0017-app-standards">ADR 0017: ParaTime Application Standard Proposal Process</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0020-governance-delegator-votes">ADR 0020: Governance Support for Delegator Votes</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>ADR 0004: Runtime Governance</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="component">Component<a class="hash-link" href="#component" title="Direct link to heading">​</a></h2><p>Oasis Core</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="changelog">Changelog<a class="hash-link" href="#changelog" title="Direct link to heading">​</a></h2><ul><li>2020-10-07: Add per-role max node limits, minimum required election pool size</li><li>2020-09-30: Add entity whitelist admission policy max nodes limit</li><li>2020-09-17: Initial draft</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="status">Status<a class="hash-link" href="#status" title="Direct link to heading">​</a></h2><p>Accepted</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="context">Context<a class="hash-link" href="#context" title="Direct link to heading">​</a></h2><p>Currently all runtimes can only be governed by a single entity -- the runtime
owner. In this regard governance means being able to update certain fields in
the runtime descriptor stored by the consensus layer registry service. On one
hand the runtime descriptor contains security-critical parameters and on the
other there needs to be a mechanism through which the runtimes can be upgraded
(especially so for TEE-based runtimes where a specific runtime binary is
enforced via remote attestation mechanisms).</p><p>This proposal extends runtime governance options and enables a path towards
runtimes that can define their own governance mechanisms. This proposal assumes
that <a href="/adrs/0003-consensus-runtime-token-transfer">ADR 0003</a> has been adopted and runtimes can have their own accounts in the
staking module.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="decision">Decision<a class="hash-link" href="#decision" title="Direct link to heading">​</a></h2><p>This proposal takes a simplistic but powerful approach which allows each runtime
to choose its governance model upon its first registration. It does so through
a newly introduced field in the runtime descriptor which indicates how the
runtime descriptor can be updated in the future.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="runtime-descriptor">Runtime Descriptor<a class="hash-link" href="#runtime-descriptor" title="Direct link to heading">​</a></h3><p>The runtime descriptor version is bumped to <code>2</code>. Version <code>1</code> descriptors are
accepted at genesis and are converted to the new format by assuming the entity
governance model as that is the only option in v1. All new runtime registrations
must use the v2 descriptor.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="governance-model">Governance Model<a class="hash-link" href="#governance-model" title="Direct link to heading">​</a></h4><p>This proposal updates the runtime descriptor by adding fields as follows:</p><div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">type Runtime struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // GovernanceModel specifies the runtime governance model.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GovernanceModel RuntimeGovernanceModel `json:&quot;governance_model&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ... existing fields omitted ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// RuntimeGovernanceModel specifies the runtime governance model.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type RuntimeGovernanceModel uint8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GovernanceEntity    RuntimeGovernanceModel = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GovernanceRuntime   RuntimeGovernanceModel = 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GovernanceConsensus RuntimeGovernanceModel = 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// ... some text serialization methods omitted ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>governance_model</code> field can specifiy one of the following governance
models:</p><ul><li><p><strong>Entity governance (<code>GovernanceEntity</code>).</strong> This causes the runtime to behave
exactly as before, the runtime owner (indicated by <code>entity_id</code> in the runtime
descriptor) is the only one who can update the runtime descriptor via
<code>registry.RegisterRuntime</code> method calls.</p><p>The runtime owner is also the one that needs to provide the required stake
in escrow in order to avoid the runtime from being suspended. As before note
that anyone can delegate the required stake to the runtime owner in order to
enable runtime operation (but the owner can always prevent the runtime from
operating by performing actions which would cause the stake claims to no
longer be satisfied).</p></li><li><p><strong>Runtime-defined governance (<code>GovernanceRuntime</code>).</strong> In this case the runtime
itself is the only one who can update the runtime descriptor by emitting a
runtime message. The runtime owner (indicated by <code>entity_id</code>) is not able to
perform any updates after the initial registration and such attempts must
return <code>ErrForbidden</code>.</p><p>The runtime itself is the one that needs to provide the required stake in
escrow in order to avoid the runtime from being suspended. This assumes that
runtimes can have accounts in the staking module as specified by <a href="/adrs/0003-consensus-runtime-token-transfer">ADR 0003</a>.
Note that anyone can delegate the required stake to a runtime in order to
enable its operation.</p></li><li><p><strong>Consensus layer governance (<code>GovernanceConsensus</code>).</strong> In this case only the
consensus layer itself can update the runtime descriptor either through a
network upgrade or via a consensus layer governance mechanism not specified by
this proposal.</p><p>Runtimes using this governance model are never suspended and do not need to
provide stake in escrow.</p><p>Runtimes using this governance model cannot be registered/updated via regular
registry method calls or runtime messages (doing so must return
<code>ErrForbidden</code>). Instead such a runtime can only be registered at genesis,
through a network upgrade or via a consensus layer governance mechanism not
specified by this proposal.</p></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="entity-whitelist-admission-policy">Entity Whitelist Admission Policy<a class="hash-link" href="#entity-whitelist-admission-policy" title="Direct link to heading">​</a></h4><p>The entity whitelist admission policy configuration structure is changed to
allow specifying the maximum number of nodes that each entity can register under
the given runtime for each role.</p><div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">type EntityWhitelistConfig struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // MaxNodes is the maximum number of nodes that an entity can register under</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // the given runtime for a specific role. If the map is empty or absent, the</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // number of nodes is unlimited. If the map is present and non-empty, the</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // the number of nodes is restricted to the specified maximum (where zero</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // means no nodes allowed), any missing roles imply zero nodes.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MaxNodes map[node.RolesMask]uint16 `json:&quot;max_nodes,omitempty&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type EntityWhitelistRuntimeAdmissionPolicy struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Entities map[signature.PublicKey]EntityWhitelistConfig `json:&quot;entities&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The new <code>max_nodes</code> field specifies the maximum number of nodes an entity can
register for the given runtime for each role. If the map is empty or absent, the
number of nodes is unlimited. If the map is present and non-empty, the number of
nodes is restricted to the specified number (where zero means no nodes are
allowed). Any missing roles imply zero nodes.</p><p>Each key (roles mask) in the <code>max_nodes</code> map must specify a single role,
otherwise the runtime descriptor is rejected with <code>ErrInvalidArgument</code>.</p><p>When transforming runtime descriptors from version 1, an entry in the <code>entities</code>
field maps to an <code>EntityWhitelistConfig</code> structure with <code>max_nodes</code> absent,
denoting that an unlimited number of nodes is allowed (as before).</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="minimum-required-committee-election-pool-size">Minimum Required Committee Election Pool Size<a class="hash-link" href="#minimum-required-committee-election-pool-size" title="Direct link to heading">​</a></h4><p>The executor and storage runtime parameters are updated to add a new field
defining the minimum required committee election pool size. The committee
scheduler is updated to refuse election for a given runtime committee in case
the number of candidate nodes is less than the configured minimum pool size.</p><div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">type ExecutorParameters struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // MinPoolSize is the minimum required candidate compute node pool size.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MinPoolSize uint64 `json:&quot;min_pool_size&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ... existing fields omitted ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type StorageParameters struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // MinPoolSize is the minimum required candidate storage node pool size.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MinPoolSize uint64 `json:&quot;min_pool_size&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ... existing fields omitted ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The value of <code>min_pool_size</code> must be non-zero and must be equal to or greater
than the corresponding sum of <code>group_size</code> and <code>group_backup_size</code>. Otherwise
the runtime descriptor is rejected with <code>ErrInvalidArgument</code>.</p><p>When transforming runtime descriptors from version 1, <code>min_pool_size</code> for the
executor committee is computed as <code>group_size + group_backup_size</code> while the
<code>min_pool_size</code> for the storage committee is equal to <code>group_size</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="state">State<a class="hash-link" href="#state" title="Direct link to heading">​</a></h3><p>This proposal introduces/updates the following consensus state in the registry
module:</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="stored-runtime-descriptors">Stored Runtime Descriptors<a class="hash-link" href="#stored-runtime-descriptors" title="Direct link to heading">​</a></h4><p>Since the runtime descriptors can now be updated by actors other than the
initial registering entity, it does not make sense to store signed runtime
descriptors. The value of storage key prefixed with <code>0x13</code> which previously
contained signed runtime descriptors is modified to store plain runtime
descriptors.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="genesis-document">Genesis Document<a class="hash-link" href="#genesis-document" title="Direct link to heading">​</a></h3><p>This proposal updates the registry part of the genesis document as follows:</p><ul><li><p>The type of the <code>runtimes</code> field is changed to a list of runtime descriptors
(was a list of <em>signed</em> runtime descriptors before).</p></li><li><p>The type of the <code>suspended_runtimes</code> field is changed to a list of runtime
descriptors (was a list of <em>signed</em> runtime descriptors before).</p></li></ul><p>Runtime descriptors must be transformed to support the new fields.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="transaction-methods">Transaction Methods<a class="hash-link" href="#transaction-methods" title="Direct link to heading">​</a></h3><p>This proposal updates the following transaction methods in the registry module:</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="register-runtime">Register Runtime<a class="hash-link" href="#register-runtime" title="Direct link to heading">​</a></h4><p>Runtime registration enables a new runtime to be created or an existing runtime
to be updated (in case the governance model allows it).</p><p><strong>Method name:</strong></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">registry.RegisterRuntime</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The body of a register runtime transaction must be a <code>Runtime</code> descriptor.
The signer of the transaction must be the owning entity key.</p><p>Registering a runtime may require sufficient stake in either the owning entity&#x27;s
(when entity governance is used) or the runtime&#x27;s (when runtime governance is
used) escrow account.</p><p>Changing the governance model from <code>GovernanceEntity</code> to <code>GovernanceRuntime</code> is
allowed. Any other governance model changes are not allowed and must fail with
<code>ErrForbidden</code>. Support for other changes is deferred to a consensus layer
governance mechanism not specified by this proposal.</p><p>Using the <code>GovernanceRuntime</code> governance model for a runtime of any kind other
than <code>KindCompute</code> must return <code>ErrInvalidArgument</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="messages">Messages<a class="hash-link" href="#messages" title="Direct link to heading">​</a></h3><p>This proposal introduces the following runtime messages:</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="update-runtime-descriptor">Update Runtime Descriptor<a class="hash-link" href="#update-runtime-descriptor" title="Direct link to heading">​</a></h4><p>The update runtime descriptor message enables a runtime to update its own
descriptor when the current governance model allows it.</p><p><strong>Field name:</strong></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">update_runtime</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Body:</strong></p><div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">type UpdateRuntimeMessage struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    registry.Runtime</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The body of the update runtime descriptor message is a new runtime descriptor
that must be for the runtime emitting this message. Otherwise the message is
considered malformed.</p><p>The actions performed when processing the message are the same as those
performed when processing the <code>registry.RegisterRuntime</code> method call, just made
on the runtime&#x27;s (instead of an entity&#x27;s) behalf.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="consensus-parameters">Consensus Parameters<a class="hash-link" href="#consensus-parameters" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="registry">Registry<a class="hash-link" href="#registry" title="Direct link to heading">​</a></h4><p>This proposal introduces the following new consensus parameters in the registry
module:</p><ul><li><code>enable_runtime_governance_models</code> (set of <code>RuntimeGovernanceModel</code>) specifies
the set of runtime governance models that are allowed to be used when
creating/updating registrations (either via method calls or via runtime
messages). In case a runtime is using a governance model not specified in this
list, an update to such a runtime must fail with <code>ErrForbidden</code>.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="rust-runtime-support-library">Rust Runtime Support Library<a class="hash-link" href="#rust-runtime-support-library" title="Direct link to heading">​</a></h3><p>The Rust runtime support library (<code>oasis-core-runtime</code>) must be updated to
support the updated and newly needed message structures (the runtime descriptor
and the update runtime message).</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="consequences">Consequences<a class="hash-link" href="#consequences" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="positive">Positive<a class="hash-link" href="#positive" title="Direct link to heading">​</a></h3><ul><li><p>Runtimes can define their governance model, enabling them to become more
decentralized while still allowing upgrades.</p></li><li><p>Runtimes using the entity whitelist admission policy can limit the number of
nodes that each entity can register.</p></li><li><p>Runtimes can specify the minimum size of the compute/storage node pool from
which committees are elected.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="negative">Negative<a class="hash-link" href="#negative" title="Direct link to heading">​</a></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="neutral">Neutral<a class="hash-link" href="#neutral" title="Direct link to heading">​</a></h3><h2 class="anchor anchorWithStickyNavbar_LWe7" id="references">References<a class="hash-link" href="#references" title="Direct link to heading">​</a></h2><ul><li><a href="/adrs/0003-consensus-runtime-token-transfer">ADR 0003</a> - Consensus/Runtime Token Transfer</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/oasisprotocol/adrs/edit/main/0004-runtime-governance.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-01-23T16:21:40.000Z">Jan 23, 2023</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/adrs/0003-consensus-runtime-token-transfer"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">ADR 0003: Consensus/Runtime Token Transfer</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/adrs/0005-runtime-compute-slashing"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">ADR 0005: Runtime Compute Node Slashing</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#component" class="table-of-contents__link toc-highlight">Component</a></li><li><a href="#changelog" class="table-of-contents__link toc-highlight">Changelog</a></li><li><a href="#status" class="table-of-contents__link toc-highlight">Status</a></li><li><a href="#context" class="table-of-contents__link toc-highlight">Context</a></li><li><a href="#decision" class="table-of-contents__link toc-highlight">Decision</a><ul><li><a href="#runtime-descriptor" class="table-of-contents__link toc-highlight">Runtime Descriptor</a></li><li><a href="#state" class="table-of-contents__link toc-highlight">State</a></li><li><a href="#genesis-document" class="table-of-contents__link toc-highlight">Genesis Document</a></li><li><a href="#transaction-methods" class="table-of-contents__link toc-highlight">Transaction Methods</a></li><li><a href="#messages" class="table-of-contents__link toc-highlight">Messages</a></li><li><a href="#consensus-parameters" class="table-of-contents__link toc-highlight">Consensus Parameters</a></li><li><a href="#rust-runtime-support-library" class="table-of-contents__link toc-highlight">Rust Runtime Support Library</a></li></ul></li><li><a href="#consequences" class="table-of-contents__link toc-highlight">Consequences</a><ul><li><a href="#positive" class="table-of-contents__link toc-highlight">Positive</a></li><li><a href="#negative" class="table-of-contents__link toc-highlight">Negative</a></li><li><a href="#neutral" class="table-of-contents__link toc-highlight">Neutral</a></li></ul></li><li><a href="#references" class="table-of-contents__link toc-highlight">References</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Support</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/pJdWeVtmHT" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Watch us</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.youtube.com/channel/UC35UFPcZ2F1wjPxhPrSsESQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Oasis Protocol Foundation. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.df39c847.js"></script>
<script src="/assets/js/main.4ff8f277.js"></script>
</body>
</html>