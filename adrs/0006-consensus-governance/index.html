<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-adrs/0006-consensus-governance">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">ADR 0006: Consensus Governance | Oasis Network Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.oasis.io/adrs/0006-consensus-governance"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="ADR 0006: Consensus Governance | Oasis Network Documentation"><meta data-rh="true" name="description" content="Component"><meta data-rh="true" property="og:description" content="Component"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.oasis.io/adrs/0006-consensus-governance"><link data-rh="true" rel="alternate" href="https://docs.oasis.io/adrs/0006-consensus-governance" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.oasis.io/adrs/0006-consensus-governance" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.03bfe953.css">
<link rel="preload" href="/assets/js/runtime~main.df39c847.js" as="script">
<link rel="preload" href="/assets/js/main.4ff8f277.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="OPF Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="OPF Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Oasis Docs</b></a><a class="navbar__item navbar__link" href="/general/">Use Oasis</a><a class="navbar__item navbar__link" href="/get-involved/">Get Involved</a><a class="navbar__item navbar__link" href="/node/">Run Node</a><a class="navbar__item navbar__link" href="/dapp/">Create dApp</a><a class="navbar__item navbar__link" href="/paratime/">Build ParaTime</a><a class="navbar__item navbar__link" href="/core/">Develop Core</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/oasisprotocol" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" title="GitHub repository" aria-label="GitHub repository"></a><a href="https://oasisprotocol.org/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-www-link" title="Oasis Protocol Foundation website" aria-label="Oasis Protocol Foundation website"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_Pkmr"><kbd class="searchHint_iIMx">ctrl</kbd><kbd class="searchHint_iIMx">K</kbd></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/adrs">Architectural Decision Records</a><button aria-label="Toggle the collapsible sidebar category &#x27;Architectural Decision Records&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0001-tm-multi-root-apphash">ADR 0001: Multiple Roots Under the Tendermint Application Hash</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0002-go-modules-compatible-git-tags">ADR 0002: Go Modules Compatible Git Tags</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0003-consensus-runtime-token-transfer">ADR 0003: Consensus/Runtime Token Transfer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0004-runtime-governance">ADR 0004: Runtime Governance</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0005-runtime-compute-slashing">ADR 0005: Runtime Compute Node Slashing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/adrs/0006-consensus-governance">ADR 0006: Consensus Governance</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0007-improved-random-beacon">ADR 0007: Improved Random Beacon</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0008-standard-account-key-generation">ADR 0008: Standard Account Key Generation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0009-ed25519-semantics">ADR 0009: Ed25519 Signature Verification Semantics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0010-vrf-elections">ADR 0010: VRF-based Committee Elections</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0011-incoming-runtime-messages">ADR 0011: Incoming Runtime Messages</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0012-runtime-message-results">ADR 0012: Runtime Message Results</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0013-runtime-upgrades">ADR 0013: Runtime Upgrade Improvements</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0014-runtime-signing-tx-with-hardware-wallet">ADR 0014: Signing Runtime Transactions with Hardware Wallet</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0015-vrf-per-block-entropy">ADR 0015: Randomized Paratime Proposer Selection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0016-consensus-parameters-change-proposal">ADR 0016: Consensus Parameters Change Proposal</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0017-app-standards">ADR 0017: ParaTime Application Standard Proposal Process</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0020-governance-delegator-votes">ADR 0020: Governance Support for Delegator Votes</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>ADR 0006: Consensus Governance</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="component">Component<a class="hash-link" href="#component" title="Direct link to heading">​</a></h2><p>Oasis Core</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="changelog">Changelog<a class="hash-link" href="#changelog" title="Direct link to heading">​</a></h2><ul><li>2021-03-30: Update name of the CastVote method&#x27;s body</li><li>2021-01-06: Update API to include Proposals() method</li><li>2020-12-08: Updates to match the actual implementation</li><li>2020-10-27: Voting period in epochs, min upgrade cancellation difference,
failed proposal state</li><li>2020-10-16: Initial draft</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="status">Status<a class="hash-link" href="#status" title="Direct link to heading">​</a></h2><p>Accepted</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="context">Context<a class="hash-link" href="#context" title="Direct link to heading">​</a></h2><p>Currently the consensus layer does not contain any on-chain governance
mechanism so any network upgrades need to be carefully coordinated off-chain.
An on-chain governance mechanism would allow upgrades to be handled in a more
controlled (and automatable) manner without introducing the risk of corrupting
state.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="decision">Decision<a class="hash-link" href="#decision" title="Direct link to heading">​</a></h2><p>This proposal introduces a minimal on-chain governance mechanism where anyone
can submit governance proposals and the validators can vote where one base unit
of delegated stake counts as one vote.</p><p>The high-level overview is as follows:</p><ul><li><p><strong>A new governance API</strong> is added to the consensus layer and its Tendermint
based implementation. It supports transactions for submitting proposals and
voting on proposals. It supports queries for listing current proposals and
votes for any given proposal.</p></li><li><p><strong>Two governance proposal kinds are supported</strong>, a consensus layer upgrade
proposal (where the content is basically the existing upgrade descriptor) and
the cancellation of a pending upgrade.</p></li></ul><p>A proposal is created through a <em>submit proposal</em> transaction and requires a
minimum deposit (which is later refunded in case the proposal passes). Once a
proposal is successfully submitted the voting period starts. Entities that are
part of the validator set may cast votes for the proposal. After the voting
period completes, the votes are tallied and the proposal either passes or is
rejected.</p><p>In case the proposal passes, the actions specified in the content of the propsal
are executed. Currently the only actions are scheduling of an upgrade by
publishing an upgrade descriptor or cancelling a previously passed upgrade.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="state">State<a class="hash-link" href="#state" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="staking">Staking<a class="hash-link" href="#staking" title="Direct link to heading">​</a></h4><p>This proposal adds the following consensus layer state in the staking module:</p><ul><li><strong>Governance deposits account balance (<code>0x59</code>)</strong>, similar to the common pool.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="governance">Governance<a class="hash-link" href="#governance" title="Direct link to heading">​</a></h4><p>This proposal adds the following consensus layer state in the governance module:</p><ul><li><p><strong>Next proposal identifier (<code>0x80</code>)</strong></p><p>The next proposal identifier is stored as a CBOR-serialized <code>uint64</code>.</p></li><li><p><strong>List of proposals (<code>0x81</code>)</strong></p><p>Each proposal is stored under a separate storage key with the following key
format:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">0x81 &lt;proposal-id (uint64)&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And CBOR-serialized value:</p><div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// ProposalState is the state of the proposal.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type ProposalState uint8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    StateActive   ProposalState = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    StatePassed   ProposalState = 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    StateRejected ProposalState = 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    StateFailed   ProposalState = 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Proposal is a consensus upgrade proposal.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type Proposal struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ID is the unique identifier of the proposal.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ID uint64 `json:&quot;id&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Submitter is the address of the proposal submitter.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Submitter staking.Address `json:&quot;submitter&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // State is the state of the proposal.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    State ProposalState `json:&quot;state&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Deposit is the deposit attached to the proposal.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Deposit quantity.Quantity `json:&quot;deposit&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Content is the content of the proposal.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Content ProposalContent `json:&quot;content&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // CreatedAt is the epoch at which the proposal was created.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CreatedAt beacon.EpochTime `json:&quot;created_at&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ClosesAt is the epoch at which the proposal will close and votes will</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // be tallied.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ClosesAt beacon.EpochTime `json:&quot;closes_at&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Results are the final tallied results after the voting period has</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ended.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Results map[Vote]quantity.Quantity `json:&quot;results,omitempty&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // InvalidVotes is the number of invalid votes after tallying.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    InvalidVotes uint64 `json:&quot;invalid_votes,omitempty&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><strong>List of active proposals (<code>0x82</code>)</strong></p><p>Each active proposal (one that has not yet closed) is stored under a separate
storage key with the following key format:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">0x82 &lt;closes-at-epoch (uint64)&gt; &lt;proposal-id (uint64)&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The value is empty as the proposal ID can be inferred from the key.</p></li><li><p><strong>List of votes (<code>0x83</code>)</strong></p><p>Each vote is stored under a separate storage key with the following key
format:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">0x83 &lt;proposal-id (uint64)&gt; &lt;voter-address (staking.Address)&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And CBOR-serialized value:</p><div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Vote is a governance vote.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type Vote uint8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    VoteYes     Vote = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    VoteNo      Vote = 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    VoteAbstain Vote = 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><strong>List of pending upgrades (<code>0x84</code>)</strong></p><p>Each pending upgrade is stored under a separate storage key with the following
key format:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">0x84 &lt;upgrade-epoch (uint64)&gt; &lt;proposal-id (uint64)&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The value is empty as the proposal upgrade descriptor can be obtained via
proposal that can be inferred from the key.</p></li><li><p><strong>Parameters (<code>0x85</code>)</strong></p><p>Governance consensus parameters.</p><p>With CBOR-serialized value:</p><div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// ConsensusParameters are the governance consensus parameters.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type ConsensusParameters struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // GasCosts are the governance transaction gas costs.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GasCosts transaction.Costs `json:&quot;gas_costs,omitempty&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // MinProposalDeposit is the number of base units that are deposited when</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // creating a new proposal.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MinProposalDeposit quantity.Quantity `json:&quot;min_proposal_deposit,omitempty&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // VotingPeriod is the number of epochs after which the voting for a proposal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // is closed and the votes are tallied.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    VotingPeriod beacon.EpochTime `json:&quot;voting_period,omitempty&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Quorum is he minimum percentage of voting power that needs to be cast on</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // a proposal for the result to be valid.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Quorum uint8 `json:&quot;quorum,omitempty&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Threshold is the minimum percentage of VoteYes votes in order for a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // proposal to be accepted.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Threshold uint8 `json:&quot;threshold,omitempty&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // UpgradeMinEpochDiff is the minimum number of epochs between the current</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // epoch and the proposed upgrade epoch for the upgrade proposal to be valid.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // This is also the minimum number of epochs between two pending upgrades.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    UpgradeMinEpochDiff beacon.EpochTime `json:&quot;upgrade_min_epoch_diff,omitempty&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // UpgradeCancelMinEpochDiff is the minimum number of epochs between the current</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // epoch and the proposed upgrade epoch for the upgrade cancellation proposal to be valid.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    UpgradeCancelMinEpochDiff beacon.EpochTime `json:&quot;upgrade_cancel_min_epoch_diff,omitempty&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="genesis-document">Genesis Document<a class="hash-link" href="#genesis-document" title="Direct link to heading">​</a></h3><p>The genesis document needs to be updated to include a <code>governance</code> field with
any initial state (see <a href="#state"><em>State</em></a>) and consensus parameters (see <a href="#consensus-parameters"><em>Consensus
Parameters</em></a>) for the governance service.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="transaction-methods">Transaction Methods<a class="hash-link" href="#transaction-methods" title="Direct link to heading">​</a></h3><p>This proposal adds the following transaction methods in the governance module:</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="submit-proposal">Submit Proposal<a class="hash-link" href="#submit-proposal" title="Direct link to heading">​</a></h4><p>Proposal submission enables a new consensus layer governance proposal to be
created.</p><p><strong>Method name:</strong></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">governance.SubmitProposal</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Body:</strong></p><div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// ProposalContent is a consensus layer governance proposal content.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type ProposalContent struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Upgrade       *UpgradeProposal       `json:&quot;upgrade,omitempty&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CancelUpgrade *CancelUpgradeProposal `json:&quot;cancel_upgrade,omitempty&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// UpgradeProposal is an upgrade proposal.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type UpgradeProposal struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    upgrade.Descriptor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// CancelUpgradeProposal is an upgrade cancellation proposal.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type CancelUpgradeProposal struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ProposalID is the identifier of the pending upgrade proposal.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ProposalID uint64 `json:&quot;proposal_id&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Fields:</strong></p><ul><li><code>upgrade</code> (optional) specifies an upgrade proposal.</li><li><code>cancel_upgrade</code> (optional) specifies an upgrade cancellation proposal.</li></ul><p>Exactly one of the proposal kind fields needs to be non-nil, otherwise the
proposal is considered malformed.</p><p>Upon processing any proposal the following steps are first performed:</p><ul><li><p>The account indicated by the signer is loaded.</p></li><li><p>If the account balance is less than <code>min_proposal_deposit</code>, the method call
fails with <code>ErrInsufficientBalance</code>.</p></li></ul><p>Upon processing an <strong><code>UpgradeProposal</code></strong> the following steps are then performed:</p><ul><li><p>The upgrade descriptor is checked for basic internal validity. If the check
fails, the method call fails with <code>ErrInvalidArgument</code>.</p></li><li><p>The upgrade descriptor&#x27;s <code>epoch</code> field is compared with the current epoch. If
the specified epoch is not at least <code>upgrade_min_epoch_diff</code> epochs ahead of
the current epoch, the method call fails with <code>ErrUpgradeTooSoon</code>.</p></li><li><p>The set of pending upgrades is checked to make sure that no upgrades are
currently pending within <code>upgrade_min_epoch_diff</code> epochs of the upgrade
descriptor&#x27;s <code>epoch</code> field. If there is such an existing upgrade pending, the
method call fails with <code>ErrUpgradeAlreadyPending</code>.</p></li></ul><p>Upon processing a <strong><code>CancelUpgradeProposal</code></strong> the following steps are then
performed:</p><ul><li><p>The set of pending upgrades is checked to make sure that the given upgrade
proposal is currently pending to be executed. If there is no such upgrade, the
method call fails with <code>ErrNoSuchUpgrade</code>.</p></li><li><p>The upgrade descriptor&#x27;s <code>epoch</code> field is compared with the current epoch. If
the specified epoch is not at least <code>upgrade_cancel_min_epoch_diff</code> epochs
ahead of the current epoch, the method call fails with <code>ErrUpgradeTooSoon</code>.</p></li></ul><p>Upon processing any proposal the following steps are then performed:</p><ul><li><p>The <code>min_proposal_deposit</code> base units are transferred from the signer&#x27;s
account to the governance service&#x27;s <em>proposal deposit account</em>.</p></li><li><p>The signer&#x27;s account is saved.</p></li><li><p>A new proposal is created and assigned an identifier.</p></li><li><p>The corresponding <code>ProposalSubmittedEvent</code> is emitted with the following
structure:</p><div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">type ProposalSubmittedEvent struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ID is the unique identifier of a proposal.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ID uint64 `json:&quot;id&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Submitter is the staking account address of the submitter.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Submitter staking.Address `json:&quot;submitter&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>The corresponding <code>staking.TransferEvent</code> is emitted, indicating transfer from
the submitter&#x27;s account to the <em>proposal deposit account</em>.</p></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="vote">Vote<a class="hash-link" href="#vote" title="Direct link to heading">​</a></h4><p>Voting for submitted consensus layer governance proposals.</p><p><strong>Method name:</strong></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">governance.CastVote</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Body:</strong></p><div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">type ProposalVote struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ID is the unique identifier of a proposal.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ID uint64 `json:&quot;id&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Vote is the vote.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Vote Vote `json:&quot;vote&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Upon processing a vote the following steps are performed:</p><ul><li><p>The entity descriptor corresponding to the transaction signer is fetched. In
case no such entity exists, the method call fails with <code>ErrNotEligible</code>.</p></li><li><p>It is checked whether any entity&#x27;s nodes are in the current validator set. In
case they are not, the method call fails with <code>ErrNotEligible</code>.</p></li><li><p>The proposal identified by <code>id</code> is loaded. If the proposal does not exist,
the method call fails with <code>ErrNoSuchProposal</code>.</p></li><li><p>If the proposal&#x27;s state is not <code>StateActive</code>, the method call fails with
<code>ErrVotingIsClosed</code>.</p></li><li><p>The vote is added to the list of votes. If the vote already exists, it is
overwritten.</p></li><li><p>The corresponding <code>VoteEvent</code> is emitted with the following structure:</p><div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">type VoteEvent struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ID is the unique identifier of a proposal.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ID uint64 `json:&quot;id&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Submitter is the staking account address of the submitter.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Submitter staking.Address `json:&quot;submitter&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Vote is the cast vote.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Vote Vote `json:&quot;vote&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="queries">Queries<a class="hash-link" href="#queries" title="Direct link to heading">​</a></h3><p>This proposal introduces the following query methods in the governance module:</p><div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">type Backend interface {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ActiveProposals returns a list of all proposals that have not yet closed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ActiveProposals(ctx context.Context, height int64) ([]*Proposal, error)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Proposals returns a list of all proposals.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Proposals(ctx context.Context, height int64) ([]*Proposal, error)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Proposal looks up a specific proposal.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Proposal(ctx context.Context, query *ProposalQuery) (*Proposal, error)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Votes looks up votes for a specific proposal.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Votes(ctx context.Context, query *ProposalQuery) ([]*VoteEntry, error)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // PendingUpgrades returns a list of all pending upgrades.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PendingUpgrades(ctx context.Context, height int64) ([]*upgrade.Descriptor, error)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // StateToGenesis returns the genesis state at specified block height.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    StateToGenesis(ctx context.Context, height int64) (*Genesis, error)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ConsensusParameters returns the governance consensus parameters.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ConsensusParameters(ctx context.Context, height int64) (*ConsensusParameters, error)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // GetEvents returns the events at specified block height.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GetEvents(ctx context.Context, height int64) ([]*Event, error)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // WatchEvents returns a channel that produces a stream of Events.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    WatchEvents(ctx context.Context) (&lt;-chan *Event, pubsub.ClosableSubscription, error)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// ProposalQuery is a proposal query.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type ProposalQuery struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Height int64  `json:&quot;height&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ID     uint64 `json:&quot;id&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// VoteEntry contains data about a cast vote.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type VoteEntry struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Voter staking.Address `json:&quot;voter&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Vote  Vote            `json:&quot;vote&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Event signifies a governance event, returned via GetEvents.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type Event struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Height int64     `json:&quot;height,omitempty&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TxHash hash.Hash `json:&quot;tx_hash,omitempty&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ProposalSubmitted *ProposalSubmittedEvent `json:&quot;proposal_submitted,omitempty&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ProposalExecuted  *ProposalExecutedEvent  `json:&quot;proposal_executed,omitempty&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ProposalFinalized *ProposalFinalizedEvent `json:&quot;proposal_finalized,omitempty&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Vote              *VoteEvent              `json:&quot;vote,omitempty&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tallying">Tallying<a class="hash-link" href="#tallying" title="Direct link to heading">​</a></h3><p>In <code>EndBlock</code> the list of active proposals is checked to see if there was an
epoch transition in this block. If there was, the following steps are performed
for each proposal that should be closed at the current epoch:</p><ul><li><p>A mapping of current validator entity addresses to their respective active
escrow balances is prepared.</p></li><li><p>A results mapping from <code>Vote</code> to number of votes is initialized in the
proposal&#x27;s <code>results</code> field.</p></li><li><p>Votes from the list of votes for the given proposal are iterated and the
address of each vote is looked up in the prepared entity address mapping. The
corresponding number of votes (on the principle of 1 base unit equals one
vote) are added to the results mapping based on the voted option. Any votes
that are not from the current validator set are ignored and the
<code>invalid_votes</code> field is incremented for each such vote.</p></li><li><p>In case the percentage of votes relative to the total voting power is less
than <code>quorum</code>, the proposal is rejected.</p></li><li><p>In case the percentage of <code>VoteYes</code> votes relative to all valid votes is less
than <code>threshold</code>, the proposal is rejected.</p></li><li><p>Otherwise the proposal is passed.</p></li><li><p>The proposal&#x27;s status is changed to either <code>StatePassed</code> or <code>StateRejected</code>
and the proposal is saved.</p></li><li><p>The proposal is removed from the list of active proposals.</p></li><li><p>In case the proposal has been passed, the proposal content is executed. If
proposal execution fails, the proposal&#x27;s state is changed to <code>StateFailed</code>.</p></li><li><p>The corresponding <code>ProposalFinalizedEvent</code> is emitted with the following
structure:</p><div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">type ProposalFinalizedEvent struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ID is the unique identifier of a proposal.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ID uint64 `json:&quot;id&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // State is the new proposal state.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    State ProposalState `json:&quot;state&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>In case the proposal has been passed, the deposit is transferred back to the
proposal submitter and a corresponding <code>staking.TransferEvent</code> is emitted,
indicating transfer from the <em>proposal deposit account</em> to the submitter&#x27;s
account.</p></li><li><p>In case the proposal has been rejected, the deposit is transferred to the
common pool and a corresponding <code>staking.TransferEvent</code> is emitted,
indicating transfer from the <em>proposal deposit account</em> to the common pool
account.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="proposal-content-execution">Proposal Content Execution<a class="hash-link" href="#proposal-content-execution" title="Direct link to heading">​</a></h3><p>After any proposal is successfully executed the corresponding
<code>ProposalExecutedEvent</code> is emitted with the following structure:</p><div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">type ProposalExecutedEvent struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ID is the unique identifier of a proposal.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ID uint64 `json:&quot;id&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="upgrade-proposal">Upgrade Proposal<a class="hash-link" href="#upgrade-proposal" title="Direct link to heading">​</a></h4><p>The set of pending upgrades is checked to make sure that no upgrades are
currently pending within <code>upgrade_min_epoch_diff</code> of the upgrade descriptor&#x27;s
<code>epoch</code> field. If there is such an existing pending upgrade the upgrade proposal
execution fails.</p><p>When an upgrade proposal is executed, a new entry is added to the list of
pending upgrades using <code>epoch</code> as <code>&lt;upgrade-epoch&gt;</code>.</p><p>On each epoch transition (as part of <code>BeginBlock</code>) it is checked whether a
pending upgrade is scheduled for that epoch. In case it is and we are not
running the new version, the consensus layer will panic. Otherwise, the pending
upgrade proposal is removed.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cancel-upgrade-proposal">Cancel Upgrade Proposal<a class="hash-link" href="#cancel-upgrade-proposal" title="Direct link to heading">​</a></h4><p>When a cancel upgrade proposal is executed, the proposal identified by
<code>proposal_id</code> is looked up and removed from the list of pending upgrades. In
case the pending upgrade does not exist anymore, no action is performed.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="consensus-parameters">Consensus Parameters<a class="hash-link" href="#consensus-parameters" title="Direct link to heading">​</a></h3><p>This proposal introduces the following new consensus parameters in the
governance module:</p><ul><li><p><code>gas_costs</code> (transaction.Costs) are the governance transaction gas costs.</p></li><li><p><code>min_proposal_deposit</code> (base units) specifies the number of base units that
are deposited when creating a new proposal.</p></li><li><p><code>voting_period</code> (epochs) specifies the number of epochs after which the voting
for a proposal is closed and the votes are tallied.</p></li><li><p><code>quorum</code> (uint8: <!-- -->[<!-- -->0,100<!-- -->]<!-- -->) specifies the minimum percentage of voting power
that needs to be cast on a proposal for the result to be valid.</p></li><li><p><code>threshold</code> (uint8: <!-- -->[<!-- -->0,100<!-- -->]<!-- -->) specifies the minimum percentage of <code>VoteYes</code>
votes in order for a proposal to be accepted.</p></li><li><p><code>upgrade_min_epoch_diff</code> (epochs) specifies the minimum number of epochs
between the current epoch and the proposed upgrade epoch for the upgrade
proposal to be valid. Additionally specifies the minimum number of epochs
between two consecutive pending upgrades.</p></li><li><p><code>upgrade_cancel_min_epoch_diff</code> (epochs) specifies the minimum number of
epochs between the current epoch and the proposed upgrade epoch for the
upgrade cancellation proposal to be valid.</p></li></ul><p>The following parameter sanity checks are introduced:</p><ul><li><p>Product of <code>quorum</code> and <code>threshold</code> must be 2/3+.</p></li><li><p><code>voting_period</code> must be less than <code>upgrade_min_epoch_diff</code> and
<code>upgrade_cancel_min_epoch_diff</code>.</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="consequences">Consequences<a class="hash-link" href="#consequences" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="positive">Positive<a class="hash-link" href="#positive" title="Direct link to heading">​</a></h3><ul><li>The consensus layer can coordinate on upgrades.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="negative">Negative<a class="hash-link" href="#negative" title="Direct link to heading">​</a></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="neutral">Neutral<a class="hash-link" href="#neutral" title="Direct link to heading">​</a></h3><h2 class="anchor anchorWithStickyNavbar_LWe7" id="references">References<a class="hash-link" href="#references" title="Direct link to heading">​</a></h2></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/oasisprotocol/adrs/edit/main/0006-consensus-governance.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-01-23T16:21:40.000Z">Jan 23, 2023</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/adrs/0005-runtime-compute-slashing"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">ADR 0005: Runtime Compute Node Slashing</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/adrs/0007-improved-random-beacon"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">ADR 0007: Improved Random Beacon</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#component" class="table-of-contents__link toc-highlight">Component</a></li><li><a href="#changelog" class="table-of-contents__link toc-highlight">Changelog</a></li><li><a href="#status" class="table-of-contents__link toc-highlight">Status</a></li><li><a href="#context" class="table-of-contents__link toc-highlight">Context</a></li><li><a href="#decision" class="table-of-contents__link toc-highlight">Decision</a><ul><li><a href="#state" class="table-of-contents__link toc-highlight">State</a></li><li><a href="#genesis-document" class="table-of-contents__link toc-highlight">Genesis Document</a></li><li><a href="#transaction-methods" class="table-of-contents__link toc-highlight">Transaction Methods</a></li><li><a href="#queries" class="table-of-contents__link toc-highlight">Queries</a></li><li><a href="#tallying" class="table-of-contents__link toc-highlight">Tallying</a></li><li><a href="#proposal-content-execution" class="table-of-contents__link toc-highlight">Proposal Content Execution</a></li><li><a href="#consensus-parameters" class="table-of-contents__link toc-highlight">Consensus Parameters</a></li></ul></li><li><a href="#consequences" class="table-of-contents__link toc-highlight">Consequences</a><ul><li><a href="#positive" class="table-of-contents__link toc-highlight">Positive</a></li><li><a href="#negative" class="table-of-contents__link toc-highlight">Negative</a></li><li><a href="#neutral" class="table-of-contents__link toc-highlight">Neutral</a></li></ul></li><li><a href="#references" class="table-of-contents__link toc-highlight">References</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Support</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/pJdWeVtmHT" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Watch us</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.youtube.com/channel/UC35UFPcZ2F1wjPxhPrSsESQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Oasis Protocol Foundation. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.df39c847.js"></script>
<script src="/assets/js/main.4ff8f277.js"></script>
</body>
</html>