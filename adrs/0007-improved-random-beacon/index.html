<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-adrs/0007-improved-random-beacon">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">ADR 0007: Improved Random Beacon | Oasis Network Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.oasis.io/adrs/0007-improved-random-beacon"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="ADR 0007: Improved Random Beacon | Oasis Network Documentation"><meta data-rh="true" name="description" content="Component"><meta data-rh="true" property="og:description" content="Component"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.oasis.io/adrs/0007-improved-random-beacon"><link data-rh="true" rel="alternate" href="https://docs.oasis.io/adrs/0007-improved-random-beacon" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.oasis.io/adrs/0007-improved-random-beacon" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.03bfe953.css">
<link rel="preload" href="/assets/js/runtime~main.df39c847.js" as="script">
<link rel="preload" href="/assets/js/main.4ff8f277.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="OPF Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="OPF Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Oasis Docs</b></a><a class="navbar__item navbar__link" href="/general/">Use Oasis</a><a class="navbar__item navbar__link" href="/get-involved/">Get Involved</a><a class="navbar__item navbar__link" href="/node/">Run Node</a><a class="navbar__item navbar__link" href="/dapp/">Create dApp</a><a class="navbar__item navbar__link" href="/paratime/">Build ParaTime</a><a class="navbar__item navbar__link" href="/core/">Develop Core</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/oasisprotocol" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" title="GitHub repository" aria-label="GitHub repository"></a><a href="https://oasisprotocol.org/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-www-link" title="Oasis Protocol Foundation website" aria-label="Oasis Protocol Foundation website"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_Pkmr"><kbd class="searchHint_iIMx">ctrl</kbd><kbd class="searchHint_iIMx">K</kbd></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/adrs">Architectural Decision Records</a><button aria-label="Toggle the collapsible sidebar category &#x27;Architectural Decision Records&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0001-tm-multi-root-apphash">ADR 0001: Multiple Roots Under the Tendermint Application Hash</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0002-go-modules-compatible-git-tags">ADR 0002: Go Modules Compatible Git Tags</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0003-consensus-runtime-token-transfer">ADR 0003: Consensus/Runtime Token Transfer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0004-runtime-governance">ADR 0004: Runtime Governance</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0005-runtime-compute-slashing">ADR 0005: Runtime Compute Node Slashing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0006-consensus-governance">ADR 0006: Consensus Governance</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/adrs/0007-improved-random-beacon">ADR 0007: Improved Random Beacon</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0008-standard-account-key-generation">ADR 0008: Standard Account Key Generation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0009-ed25519-semantics">ADR 0009: Ed25519 Signature Verification Semantics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0010-vrf-elections">ADR 0010: VRF-based Committee Elections</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0011-incoming-runtime-messages">ADR 0011: Incoming Runtime Messages</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0012-runtime-message-results">ADR 0012: Runtime Message Results</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0013-runtime-upgrades">ADR 0013: Runtime Upgrade Improvements</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0014-runtime-signing-tx-with-hardware-wallet">ADR 0014: Signing Runtime Transactions with Hardware Wallet</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0015-vrf-per-block-entropy">ADR 0015: Randomized Paratime Proposer Selection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0016-consensus-parameters-change-proposal">ADR 0016: Consensus Parameters Change Proposal</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0017-app-standards">ADR 0017: ParaTime Application Standard Proposal Process</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0020-governance-delegator-votes">ADR 0020: Governance Support for Delegator Votes</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>ADR 0007: Improved Random Beacon</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="component">Component<a class="hash-link" href="#component" title="Direct link to heading">​</a></h2><p>Oasis Core</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="changelog">Changelog<a class="hash-link" href="#changelog" title="Direct link to heading">​</a></h2><ul><li>2020-10-22: Initial version</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="status">Status<a class="hash-link" href="#status" title="Direct link to heading">​</a></h2><p>Proposed</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="context">Context<a class="hash-link" href="#context" title="Direct link to heading">​</a></h2><blockquote><p>Any one who considers arithmetical methods of producing random digits
is, of course, in a state of sin.</p><p>--Dr. John von  Neumann</p></blockquote><p>The existing random beacon used by Oasis Core, is largely a placeholder
implementation that naively uses the previous block&#x27;s commit hash as the
entropy input.  As such it is clearly insecure as it is subject to
manipulation.</p><p>A better random beacon which is harder for an adversary to manipulate
is required to provide entropy for secure committee elections.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="decision">Decision<a class="hash-link" href="#decision" title="Direct link to heading">​</a></h2><p>At a high level, this ADR proposes implementing an on-chain random beacon
based on &quot;SCRAPE: Scalabe Randomness Attested by Public Entities&quot; by
Cascudo and David.  The new random beacon will use a commit-reveal scheme
backed by a PVSS scheme so that as long as the threshold of participants
is met, and one participant is honest, secure entropy will be generated.</p><p>Note: This document assumes the reader understands SCRAPE. Details
regarding the underlying SCRAPE implementation are omitted for brevity.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="node-descriptor">Node Descriptor<a class="hash-link" href="#node-descriptor" title="Direct link to heading">​</a></h3><p>The node descriptor of each node will be extended to include the following
datastructure.</p><div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">type Node struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // ... existing fields omitted ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Beacon contains information for this node&#x27;s participation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // in the random beacon protocol.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  //</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // TODO: This is optional for now, make mandatory once enough</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // nodes provide this field.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Beacon *BeaconInfo `json:&quot;beacon,omitempty&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// BeaconInfo contains information for this node&#x27;s participation in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// the random beacon protocol.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type BeaconInfo struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Point is the elliptic curve point used for the PVSS algorithm.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Point scrape.Point `json:&quot;point&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Each node will generate and maintain a long term elliptic curve point
and scalar pair (public/private key pair), the point (public key) of
which will be included in the node descriptor.</p><p>For the purposes of the initial implementation, the curve will be P-256.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="consensus-parameters">Consensus Parameters<a class="hash-link" href="#consensus-parameters" title="Direct link to heading">​</a></h3><p>The beacon module will have the following consensus parameters that
control behavior.</p><div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">type SCRAPEParameters struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Participants  uint64 `json:&quot;participants&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Threshold     uint64 `json:&quot;threshold&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  PVSSThreshold uint64 `json:&quot;pvss_threshold&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  CommitInterval  int64 `json:&quot;commit_interval&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  RevealInterval  int64 `json:&quot;reveal_interval&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  TransitionDelay int64 `json:&quot;transition_delay&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Fields:</p><ul><li><p><code>Participants</code> - The number of participants to be selected for each
beacon generation protocol round.</p></li><li><p><code>Threshold</code> - The minimum number of participants which must
successfully contribute entropy for the final output to be
considered valid.</p></li><li><p><code>PVSSThreshold</code> - The minimum number of participants that are
required to reconstruct a PVSS secret from the corresponding
decrypted shares (Note: This usually should just be set to
<code>Threshold</code>).</p></li><li><p><code>CommitInterval</code> - The duration of the Commit phase, in blocks.</p></li><li><p><code>RevealInterval</code> - The duration of the Reveal phase, in blocks.</p></li><li><p><code>TransitionDelay</code> - The duration of the post Reveal phase delay, in blocks.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="consensus-state-and-events">Consensus State and Events<a class="hash-link" href="#consensus-state-and-events" title="Direct link to heading">​</a></h3><p>The on-chain beacon will maintain and make available the following consensus
state.</p><div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// RoundState is a SCRAPE round state.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type RoundState uint8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  StateInvalid  RoundState = 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  StateCommit   RoundState = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  StateReveal   RoundState = 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  StateComplete RoundState = 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// SCRAPEState is the SCRAPE backend state.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type SCRAPEState struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Height int64 `json:&quot;height,omitempty&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Epoch EpochTime  `json:&quot;epoch,omitempty&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Round uint64     `json:&quot;round,omitempty&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  State RoundState `json:&quot;state,omitempty&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Instance     *scrape.Instance      `json:&quot;instance,omitempty&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Participants []signature.PublicKey `json:&quot;participants,omitempty&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Entropy      []byte                `json:&quot;entropy,omitempty&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  BadParticipants map[signature.PublicKey]bool `json:&quot;bad_participants,omitempty&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  CommitDeadline   int64 `json:&quot;commit_deadline,omitempty&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  RevealDeadline   int64 `json:&quot;reveal_deadline,omitempty&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  TransitionHeight int64 `json:&quot;transition_height,omitempty&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  RuntimeDisableHeight int64 `json:&quot;runtime_disable_height,omitempty&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Fields:</p><ul><li><p><code>Height</code> - The block height at which the last event was emitted.</p></li><li><p><code>Epoch</code> - The epoch in which this beacon is being generated.</p></li><li><p><code>Round</code> - The epoch beacon generation round.</p></li><li><p><code>State</code> - The beacon generation step (commit/reveal/complete).</p></li><li><p><code>Instance</code> - The SCRAPE protocol state (encrypted/decrypted shares of
all participants).</p></li><li><p><code>Participants</code> - The node IDs of the nodes selected to participate
in this beacon generation round.</p></li><li><p><code>Entropy</code> - The final raw entropy, if any.</p></li><li><p><code>BadParticipants</code> - A map of nodes that were selected, but have failed
to execute the protocol correctly.</p></li><li><p><code>CommitDeadline</code> - The height in blocks by which participants must
submit their encrypted shares.</p></li><li><p><code>RevealDeadline</code> - The height in blocks by which participants must
submit their decrypted shares.</p></li><li><p><code>TransitionHeight</code> - The height at which the epoch will transition
assuming this round completes successfully.</p></li><li><p><code>RuntimeDisableHeight</code> - The height at which, upon protocol failure,
runtime transactions will be disabled.  This height will be set to
the transition height of the 0th round.</p></li></ul><p>Upon transition to a next step of the protocol, the on-chain beacon will
emit the following event.</p><div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// SCRAPEEvent is a SCRAPE backend event.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type SCRAPEEvent struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Height int64 `json:&quot;height,omitempty&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Epoch EpochTime  `json:&quot;epoch,omitempty&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Round uint64     `json:&quot;round,omitempty&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  State RoundState `json:&quot;state,omitempty&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Participants []signature.PublicKey `json:&quot;participants,omitempty&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Field definitions are identical to that of those in the <code>SCRAPEState</code>
datastructure.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="transactions">Transactions<a class="hash-link" href="#transactions" title="Direct link to heading">​</a></h2><p>Participating nodes will submit the following transactions when required,
signed by the node identity key.</p><div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">var (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // MethodSCRAPECommit is the method name for a SCRAPE commitment.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  MethodSCRAPECommit = transaction.NewMethodName(ModuleName, &quot;SCRAPECommit&quot;, SCRAPECommit{})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // MethodSCRAPEReveal is the method name for a SCRAPE reveal.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  MethodSCRAPEReveal = transaction.NewMethodName(ModuleName, &quot;SCRAPEReveal&quot;, SCRAPEReveal{})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// SCRAPECommit is a SCRAPE commitment transaction payload.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type SCRAPECommit struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Epoch EpochTime `json:&quot;epoch&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Round uint64    `json:&quot;round&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Commit *scrape.Commit `json:&quot;commit,omitempty&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// SCRAPEReveal is a SCRAPE reveal transaction payload.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type SCRAPEReveal struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Epoch EpochTime `json:&quot;epoch&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Round uint64    `json:&quot;round&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Reveal *scrape.Reveal `json:&quot;reveal,omitempty&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Fields:</p><ul><li><p><code>Epoch</code> - The epoch in which the transaction is applicable.</p></li><li><p><code>Round</code> - The epoch beacon generation round for the transaction.</p></li><li><p><code>Commit</code> - The SCRAPE commit consisting of PVSS shares encrypted to
every participant.</p></li><li><p><code>Reveal</code> - The SCRAPE reveal consisting of the decrypted result of
PVSS shares received from every participant.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="beacon-generation">Beacon Generation<a class="hash-link" href="#beacon-generation" title="Direct link to heading">​</a></h3><p>The beacon generation process is split into three sequential stages,
roughly corresponding to the steps in the SCRAPE protocol.  Any failures
in the Commit and Reveal phases result in a failed protocol round, and
the generation process will restart after disqualifying participants who
have induced the failure.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="commit-phase">Commit Phase<a class="hash-link" href="#commit-phase" title="Direct link to heading">​</a></h4><p>Upon epoch transition or a prior failed round the commit phase is initiated
the consensus application will select  <code>Particpants</code> nodes from the current
validator set (in order of decending stake) to serve as entropy contributors.</p><p>The <code>SCRAPEState</code> structure is (re)-initialized, and a <code>SCRAPEEvent</code> is
broadcast to signal to the participants that they should generate and
submit their encrypted shares via a <code>SCRAPECommit</code> transaction.</p><p>Each commit phase lasts exactly <code>CommitInterval</code> blocks, at the end of which,
the round will be closed to further commits.</p><p>At the end of the commit phase, the SCRAPE protocol state is evaluated
to ensure that <code>Threshold</code>/<code>PVSSThreshold</code> nodes have published encrypted
shares, and if an insufficient number of nodes have published in either
case, the round is considered to have failed.</p><p>The following behaviors are currently candidates for a node being marked
as malicious/non-particpatory (<code>BadParticipant</code>) and subject to exclusion
from future rounds and slashing.</p><ul><li><p>Not submitting a commitment.</p></li><li><p>Malformed commitments (corrupted/fails to validate/etc).</p></li><li><p>Attempting to alter an existing commitment for a given Epoch/Round.</p></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="reveal-phase">Reveal Phase<a class="hash-link" href="#reveal-phase" title="Direct link to heading">​</a></h4><p>When the <code>CommitInterval</code> has passed, assuming that a sufficient number of
commits have been received, the consensus application transitions into the
reveal phase by updating the <code>SCRAPEState</code> structure and broadcasting a
<code>SCRAPEEvent</code> to signal to the participants that they should reveal the
decrypted values of the encrypted shares received from other participants
via a <code>SCRAPEReveal</code> transaction.</p><p>Each reveal phase lasts exactly <code>RevealInterval</code> blocks, at the end of which,
the round will be closed to further reveals.</p><p>At the end of the reveal phase, the SCRAPE protocol state is evaluated to
ensure that <code>Threshold</code>/<code>PVSSThreshold</code> nodes have published decrypted
shares, and if an insufficient number of nodes have published in either
case, the round is considered to have failed.</p><p>The following behaviors are currently candidates for a node being marked
as malicious/non-participatory (<code>BadParticipant</code>) and subject to exclusion
from future rounds and slashing.</p><ul><li><p>Not submitting a reveal.</p></li><li><p>Malformed commitments (corrupted/fails to validate/etc).</p></li><li><p>Attempting to alter an existing reveal for a given Epoch/Round.</p></li></ul><p>Note: It is possible for anybody who can observe consensus state to derive
the entropy the moment a threshold number of <code>SCRAPEReveal</code> transactions
have been processed.  Therefore the reveal phase should be a small fraction
of the desired epoch as it is possible to derive the results of the
committee elections for the next epoch mid-reveal phase.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="complete-transition-wait-phase">Complete (Transition Wait) Phase<a class="hash-link" href="#complete-transition-wait-phase" title="Direct link to heading">​</a></h4><p>When the <code>RevealInterval</code> has passed, assuming that a sufficient number
of reveals have been received, the consensus application recovers the
final entropy output (the hash of the secret shared by each participant)
and transitions into the complete (transition wait) phase by updating the
<code>SCRAPEState</code> structure and broadcasting a <code>SCRAPEEvent</code> to signal to
participants the completion of the round.</p><p>No meaningful protocol activity happens one a round has successfully
completed, beyond the scheduling of the next epoch transition.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="misc-changesnotes">Misc. Changes/Notes<a class="hash-link" href="#misc-changesnotes" title="Direct link to heading">​</a></h3><p>Nodes MUST not be slashed for non-participation if they have not had
the opportunity to propose any blocks during the relevant interval.</p><p>Processing commitments and reveals is currently rather CPU intensive
and thus each block SHOULD only contain one of each to prevent the
consesus from stalling.</p><p>To thwart attempts to manipulate committee placement by virute of the
fact that it is possible to observe the entropy used for elections early
nodes that register between the completion of the final commit phase and
the epoch transition in any given epoch MUST be excluded from committee
eligibility.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="consequences">Consequences<a class="hash-link" href="#consequences" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="positive">Positive<a class="hash-link" href="#positive" title="Direct link to heading">​</a></h3><ul><li><p>The random beacon output is unbaised, provided that at least one
participant is honest.</p></li><li><p>The amount of consensus state required is relatively small.</p></li><li><p>All protocol messages and steps can be verified on-chain, and misbehavior
can be attributed.</p></li><li><p>The final output can be generated on-chain.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="negative">Negative<a class="hash-link" href="#negative" title="Direct link to heading">​</a></h3><ul><li><p>Epoch intervals are theoretically variable under this proposal, as the
beacon generation needs to be re-ran with new participants upon failure.</p></li><li><p>A new failure mode is introduced at the consensus layer, where the
beacon generation protocol exhausts eligible participants.</p></li><li><p>Without using pairing based cryptography, the number of participants
in the beacon generation is limited to a small subset of the anticipated
active validator set.</p></li><li><p>There is a time window where the next beacon can be derived by anyone
with access to the consensus state before the epoch transition actually
happens.  This should be mitigated by having a relatively short reveal
period.</p></li><li><p>The commit and reveal steps of the protocol are rather slow, especially
as the number of participants increases.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="neutral">Neutral<a class="hash-link" href="#neutral" title="Direct link to heading">​</a></h3><ul><li>Due to performance reasons, the curve used by the PVSS scheme will
be P-256 instead of Ed25519.  The point and scalar pairs that each
node generates on this curve are exclusively for use in the random
beacon protocol and are not used anywhere else.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="references">References<a class="hash-link" href="#references" title="Direct link to heading">​</a></h2><ul><li><a href="https://eprint.iacr.org/2017/216.pdf" target="_blank" rel="noopener noreferrer">SCRAPE: SCalabe Randomness Attested by Public Entities</a></li><li><a href="https://github.com/oasisprotocol/oasis-core/pull/3180" target="_blank" rel="noopener noreferrer">oasis-core#3180</a></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/oasisprotocol/adrs/edit/main/0007-improved-random-beacon.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-01-23T16:21:40.000Z">Jan 23, 2023</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/adrs/0006-consensus-governance"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">ADR 0006: Consensus Governance</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/adrs/0008-standard-account-key-generation"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">ADR 0008: Standard Account Key Generation</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#component" class="table-of-contents__link toc-highlight">Component</a></li><li><a href="#changelog" class="table-of-contents__link toc-highlight">Changelog</a></li><li><a href="#status" class="table-of-contents__link toc-highlight">Status</a></li><li><a href="#context" class="table-of-contents__link toc-highlight">Context</a></li><li><a href="#decision" class="table-of-contents__link toc-highlight">Decision</a><ul><li><a href="#node-descriptor" class="table-of-contents__link toc-highlight">Node Descriptor</a></li><li><a href="#consensus-parameters" class="table-of-contents__link toc-highlight">Consensus Parameters</a></li><li><a href="#consensus-state-and-events" class="table-of-contents__link toc-highlight">Consensus State and Events</a></li></ul></li><li><a href="#transactions" class="table-of-contents__link toc-highlight">Transactions</a><ul><li><a href="#beacon-generation" class="table-of-contents__link toc-highlight">Beacon Generation</a></li><li><a href="#misc-changesnotes" class="table-of-contents__link toc-highlight">Misc. Changes/Notes</a></li></ul></li><li><a href="#consequences" class="table-of-contents__link toc-highlight">Consequences</a><ul><li><a href="#positive" class="table-of-contents__link toc-highlight">Positive</a></li><li><a href="#negative" class="table-of-contents__link toc-highlight">Negative</a></li><li><a href="#neutral" class="table-of-contents__link toc-highlight">Neutral</a></li></ul></li><li><a href="#references" class="table-of-contents__link toc-highlight">References</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Support</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/pJdWeVtmHT" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Watch us</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.youtube.com/channel/UC35UFPcZ2F1wjPxhPrSsESQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Oasis Protocol Foundation. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.df39c847.js"></script>
<script src="/assets/js/main.4ff8f277.js"></script>
</body>
</html>