"use strict";(self.webpackChunkdocs_oasis_dev=self.webpackChunkdocs_oasis_dev||[]).push([[974],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>g});var r=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=r.createContext({}),p=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},c=function(e){var t=p(e.components);return r.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,l=e.parentName,c=a(e,["components","mdxType","originalType","parentName"]),u=p(n),g=i,h=u["".concat(l,".").concat(g)]||u[g]||d[g]||o;return n?r.createElement(h,s(s({ref:t},c),{},{components:n})):r.createElement(h,s({ref:t},c))}));function g(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,s=new Array(o);s[0]=u;var a={};for(var l in t)hasOwnProperty.call(t,l)&&(a[l]=t[l]);a.originalType=e,a.mdxType="string"==typeof e?e:i,s[1]=a;for(var p=2;p<o;p++)s[p]=n[p];return r.createElement.apply(null,s)}return r.createElement.apply(null,n)}u.displayName="MDXCreateElement"},3179:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>d,frontMatter:()=>o,metadata:()=>a,toc:()=>p});var r=n(7462),i=(n(7294),n(3905));const o={},s="Registry",a={unversionedId:"core/consensus/services/registry",id:"core/consensus/services/registry",title:"Registry",description:"The registry service is responsible for managing a registry of runtime, entity",source:"@site/docs/core/consensus/services/registry.md",sourceDirName:"core/consensus/services",slug:"/core/consensus/services/registry",permalink:"/core/consensus/services/registry",draft:!1,editUrl:"https://github.com/oasisprotocol/oasis-core/edit/stable/22.2.x/docs/consensus/services/registry.md",tags:[],version:"current",lastUpdatedAt:1669418750,formattedLastUpdatedAt:"Nov 25, 2022",frontMatter:{},sidebar:"oasisCore",previous:{title:"Staking",permalink:"/core/consensus/services/staking"},next:{title:"Committee Scheduler",permalink:"/core/consensus/services/scheduler"}},l={},p=[{value:"Resources",id:"resources",level:2},{value:"Entities and Nodes",id:"entities-and-nodes",level:3},{value:"Runtimes",id:"runtimes",level:3},{value:"Methods",id:"methods",level:2},{value:"Register Entity",id:"register-entity",level:3},{value:"Deregister Entity",id:"deregister-entity",level:3},{value:"Register Node",id:"register-node",level:3},{value:"Unfreeze Node",id:"unfreeze-node",level:3},{value:"Register Runtime",id:"register-runtime",level:3},{value:"Events",id:"events",level:2},{value:"Test Vectors",id:"test-vectors",level:2}],c={toc:p};function d(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"registry"},"Registry"),(0,i.kt)("p",null,"The registry service is responsible for managing a registry of runtime, entity\nand node public keys and metadata."),(0,i.kt)("p",null,"The service interface definition lives in ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/oasisprotocol/oasis-core/tree/master/go/registry/api"},(0,i.kt)("inlineCode",{parentName:"a"},"go/registry/api")),". It defines the\nsupported queries and transactions. For more information you can also check out\nthe ",(0,i.kt)("a",{parentName:"p",href:"https://pkg.go.dev/github.com/oasisprotocol/oasis-core/go/registry/api?tab=doc"},"consensus service API documentation"),"."),(0,i.kt)("h2",{id:"resources"},"Resources"),(0,i.kt)("p",null,"The registry service manages different kinds of resources which are described\nfrom a high level perspective in this section."),(0,i.kt)("h3",{id:"entities-and-nodes"},"Entities and Nodes"),(0,i.kt)("p",null,"An entity managed by the registry service is a key pair that owns resources in\nthe registry. It can represent an organization or an individual with ",(0,i.kt)("a",{parentName:"p",href:"/core/consensus/services/staking"},"stake")," on\nthe network."),(0,i.kt)("p",null,"Currently, an entity can own the following types of resources:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"nodes and"),(0,i.kt)("li",{parentName:"ul"},"runtimes.")),(0,i.kt)("p",null,"A node is a device (process running in a VM, on bare metal, in a container,\netc.) that is participating in a committee on the Oasis Core network. It is\nidentified by its own key pair."),(0,i.kt)("p",null,"The reason for separating entities from nodes is to enable separation of\nconcerns. Both nodes and entities require stake to operate (e.g., to be\nregistered in the registry and be eligible for specific roles). While entities\nhave their own (or ",(0,i.kt)("a",{parentName:"p",href:"/core/consensus/services/staking#delegation"},"delegated"),") stake, nodes use stake provided by entities that\noperate them. Nodes need to periodically refresh their resource descriptor in\nthe registry in order for it to remain fresh and to do this they need to have\nonline access to their corresponding private key(s)."),(0,i.kt)("p",null,"On the other hand entities' private keys are more sensitive as they can be used\nto manage stake and other resources. For this reason they should usually be kept\noffline and having entities as separate resources enables that."),(0,i.kt)("h3",{id:"runtimes"},"Runtimes"),(0,i.kt)("p",null,"A ",(0,i.kt)("a",{parentName:"p",href:"/core/runtime/"},"runtime")," is effectively a replicated application with shared state. The\nregistry resource describes a runtime's operational parameters, including its\nidentifier, kind, admission policy, committee scheduling, storage, governance\nmodel, etc. For a full description of the runtime descriptor see\n",(0,i.kt)("a",{parentName:"p",href:"https://pkg.go.dev/github.com/oasisprotocol/oasis-core/go/registry/api?tab=doc#Runtime"},"the ",(0,i.kt)("inlineCode",{parentName:"a"},"Runtime")," structure"),"."),(0,i.kt)("p",null,"The chosen governance model indicates how the runtime descriptor can be updated\nin the future."),(0,i.kt)("p",null,"There are currently three supported governance models:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Entity governance")," where the runtime owner is the only one who can update\nthe runtime descriptor via ",(0,i.kt)("inlineCode",{parentName:"p"},"registry.RegisterRuntime")," method calls.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Runtime-defined governance")," where the runtime itself is the only one who\ncan update the runtime descriptor by emitting a runtime message.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Consensus layer governance")," where only the consensus layer itself can\nupdate the runtime descriptor through network governance."))),(0,i.kt)("h2",{id:"methods"},"Methods"),(0,i.kt)("p",null,"The following sections describe the methods supported by the consensus registry\nservice."),(0,i.kt)("h3",{id:"register-entity"},"Register Entity"),(0,i.kt)("p",null,"Entity registration enables a new entity to be created. A new register entity\ntransaction can be generated using ",(0,i.kt)("a",{parentName:"p",href:"https://pkg.go.dev/github.com/oasisprotocol/oasis-core/go/registry/api?tab=doc#NewRegisterEntityTx"},(0,i.kt)("inlineCode",{parentName:"a"},"NewRegisterEntityTx")),"."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Method name:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"registry.RegisterEntity\n")),(0,i.kt)("p",null,"The body of a register entity transaction must be a ",(0,i.kt)("a",{parentName:"p",href:"https://pkg.go.dev/github.com/oasisprotocol/oasis-core/go/common/entity?tab=doc#SignedEntity"},(0,i.kt)("inlineCode",{parentName:"a"},"SignedEntity"))," structure,\nwhich is a ",(0,i.kt)("a",{parentName:"p",href:"/core/crypto#signed-envelope"},"signed envelope")," containing an ",(0,i.kt)("a",{parentName:"p",href:"https://pkg.go.dev/github.com/oasisprotocol/oasis-core/go/common/entity?tab=doc#Entity"},(0,i.kt)("inlineCode",{parentName:"a"},"Entity"))," descriptor. The signer of\nthe entity MUST be the same as the signer of the transaction."),(0,i.kt)("p",null,"Registering an entity may require sufficient stake in the entity's\n",(0,i.kt)("a",{parentName:"p",href:"/core/consensus/services/staking#escrow"},"escrow account"),"."),(0,i.kt)("h3",{id:"deregister-entity"},"Deregister Entity"),(0,i.kt)("p",null,"Entity deregistration enables an existing entity to be removed. A new deregister\nentity transaction can be generated using ",(0,i.kt)("a",{parentName:"p",href:"https://pkg.go.dev/github.com/oasisprotocol/oasis-core/go/registry/api?tab=doc#NewDeregisterEntityTx"},(0,i.kt)("inlineCode",{parentName:"a"},"NewDeregisterEntityTx")),"."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Method name:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"registry.DeregisterEntity\n")),(0,i.kt)("p",null,"The body of a register entity transaction must be ",(0,i.kt)("inlineCode",{parentName:"p"},"nil"),". The entity is implied\nto be the signer of the transaction."),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"If an entity still has either nodes or runtimes registered, it is not possible\nto deregister an entity and such a transaction will fail.")),(0,i.kt)("h3",{id:"register-node"},"Register Node"),(0,i.kt)("p",null,"Node registration enables a new node to be created. A new register node\ntransaction can be generated using ",(0,i.kt)("a",{parentName:"p",href:"https://pkg.go.dev/github.com/oasisprotocol/oasis-core/go/registry/api?tab=doc#NewRegisterNodeTx"},(0,i.kt)("inlineCode",{parentName:"a"},"NewRegisterNodeTx")),"."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Method name:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"registry.RegisterNode\n")),(0,i.kt)("p",null,"The body of a register entity transaction must be a ",(0,i.kt)("a",{parentName:"p",href:"https://pkg.go.dev/github.com/oasisprotocol/oasis-core/go/common/node?tab=doc#MultiSignedNode"},(0,i.kt)("inlineCode",{parentName:"a"},"MultiSignedNode")),"\nstructure, which is a ",(0,i.kt)("a",{parentName:"p",href:"/core/crypto#multi-signed-envelope"},"multi-signed envelope")," containing a ",(0,i.kt)("a",{parentName:"p",href:"https://pkg.go.dev/github.com/oasisprotocol/oasis-core/go/common/node?tab=doc#Node"},(0,i.kt)("inlineCode",{parentName:"a"},"Node"))," descriptor.\nThe signer of the transaction MUST be the node identity key."),(0,i.kt)("p",null,"The owning entity MUST have the given node identity public key whitelisted in\nthe ",(0,i.kt)("inlineCode",{parentName:"p"},"Nodes")," field in its ",(0,i.kt)("a",{parentName:"p",href:"https://pkg.go.dev/github.com/oasisprotocol/oasis-core/go/common/entity?tab=doc#Entity"},(0,i.kt)("inlineCode",{parentName:"a"},"Entity"))," descriptor."),(0,i.kt)("p",null,"The node descriptor structure MUST be signed by all of the following keys:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Node identity key."),(0,i.kt)("li",{parentName:"ul"},"Consensus key."),(0,i.kt)("li",{parentName:"ul"},"TLS key."),(0,i.kt)("li",{parentName:"ul"},"P2P key.")),(0,i.kt)("p",null,"Registering a node may require sufficient stake in the owning entity's\n",(0,i.kt)("a",{parentName:"p",href:"/core/consensus/services/staking#escrow"},"escrow account"),". There are two kinds of thresholds that the node may need to\nsatisfy:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Global thresholds are the same for all runtimes and are defined by the\nconsensus parameters (see ",(0,i.kt)("a",{parentName:"p",href:"https://pkg.go.dev/github.com/oasisprotocol/oasis-core/go/staking/api?tab=doc#ConsensusParameters.Thresholds"},(0,i.kt)("inlineCode",{parentName:"a"},"Thresholds")," in staking consensus parameters"),").")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"In ",(0,i.kt)("em",{parentName:"p"},"addition")," to the global thresholds, each runtime the node is registering\nfor may define their own thresholds. The runtime-specific thresholds are\ndefined in the ",(0,i.kt)("a",{parentName:"p",href:"https://pkg.go.dev/github.com/oasisprotocol/oasis-core/go/registry/api?tab=doc#Runtime.Staking"},(0,i.kt)("inlineCode",{parentName:"a"},"Staking")," field")," in the runtime descriptor."))),(0,i.kt)("p",null,"In case the node is registering for multiple runtimes, it needs to satisfy the\nsum of thresholds of all the runtimes it is registering for."),(0,i.kt)("h3",{id:"unfreeze-node"},"Unfreeze Node"),(0,i.kt)("p",null,"Node unfreezing enables a previously frozen (e.g., due to slashing) node to be\nthawed so it can again be eligible for committee elections. A new unfreeze node\ntransaction can be generated using ",(0,i.kt)("a",{parentName:"p",href:"https://pkg.go.dev/github.com/oasisprotocol/oasis-core/go/registry/api?tab=doc#NewUnfreezeNodeTx"},(0,i.kt)("inlineCode",{parentName:"a"},"NewUnfreezeNodeTx")),"."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Method name:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"registry.UnfreezeNode\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Body:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-golang"},'type UnfreezeNode struct {\n    NodeID signature.PublicKey `json:"node_id"`\n}\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Fields:")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"node_id")," specifies the node identifier of the node to thaw.")),(0,i.kt)("p",null,"The transaction signer MUST be the entity key that owns the node."),(0,i.kt)("p",null,"Thawing a node requires that the node's freeze period has already passed. The\nfreeze period for any given attributable fault (e.g., double signing) is a\nconsensus parameter (see ",(0,i.kt)("a",{parentName:"p",href:"https://pkg.go.dev/github.com/oasisprotocol/oasis-core/go/staking/api?tab=doc#ConsensusParameters.Slashing"},(0,i.kt)("inlineCode",{parentName:"a"},"Slashing")," in staking consensus parameters"),")."),(0,i.kt)("h3",{id:"register-runtime"},"Register Runtime"),(0,i.kt)("p",null,"Runtime registration enables a new runtime to be created. A new register\nruntime transaction can be generated using ",(0,i.kt)("a",{parentName:"p",href:"https://pkg.go.dev/github.com/oasisprotocol/oasis-core/go/registry/api?tab=doc#NewRegisterRuntimeTx"},(0,i.kt)("inlineCode",{parentName:"a"},"NewRegisterRuntimeTx")),"."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Method name:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"registry.RegisterRuntime\n")),(0,i.kt)("p",null,"The body of a register runtime transaction must be a ",(0,i.kt)("a",{parentName:"p",href:"https://pkg.go.dev/github.com/oasisprotocol/oasis-core/go/registry/api?tab=doc#Runtime"},(0,i.kt)("inlineCode",{parentName:"a"},"Runtime"))," descriptor.\nThe signer of the transaction MUST be the owning entity key."),(0,i.kt)("p",null,"Registering a runtime may require sufficient stake in either the owning\nentity's (when entity governance is used) or the runtime's (when runtime\ngovernance is used) ",(0,i.kt)("a",{parentName:"p",href:"/core/consensus/services/staking#escrow"},"escrow account"),"."),(0,i.kt)("p",null,"Changing the governance model from entity governance to runtime governance is\nallowed. Any other governance model changes are not allowed."),(0,i.kt)("h2",{id:"events"},"Events"),(0,i.kt)("h2",{id:"test-vectors"},"Test Vectors"),(0,i.kt)("p",null,"To generate test vectors for various registry ",(0,i.kt)("a",{parentName:"p",href:"/core/consensus/transactions"},"transactions"),", run:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"make -C go registry/gen_vectors\n")),(0,i.kt)("p",null,"For more information about the structure of the test vectors see the section\non ",(0,i.kt)("a",{parentName:"p",href:"/core/consensus/test-vectors"},"Transaction Test Vectors"),"."))}d.isMDXComponent=!0}}]);