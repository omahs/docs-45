"use strict";(self.webpackChunkdocs_oasis_dev=self.webpackChunkdocs_oasis_dev||[]).push([[8252],{3905:(e,t,n)=>{n.d(t,{Zo:()=>m,kt:()=>d});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),s=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},m=function(e){var t=s(e.components);return a.createElement(p.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,p=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),c=s(n),d=r,h=c["".concat(p,".").concat(d)]||c[d]||u[d]||o;return n?a.createElement(h,i(i({ref:t},m),{},{components:n})):a.createElement(h,i({ref:t},m))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=c;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var s=2;s<o;s++)i[s]=n[s];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},4469:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>s});var a=n(7462),r=(n(7294),n(3905));const o={},i="Prerequisites",l={unversionedId:"core/development-setup/prerequisites",id:"core/development-setup/prerequisites",title:"Prerequisites",description:"The following is a list of prerequisites required to start developing on Oasis",source:"@site/docs/core/development-setup/prerequisites.md",sourceDirName:"core/development-setup",slug:"/core/development-setup/prerequisites",permalink:"/core/development-setup/prerequisites",draft:!1,editUrl:"https://github.com/oasisprotocol/oasis-core/edit/stable/22.2.x/docs/development-setup/prerequisites.md",tags:[],version:"current",lastUpdatedAt:1669418750,formattedLastUpdatedAt:"Nov 25, 2022",frontMatter:{},sidebar:"oasisCore",previous:{title:"Build Environment Setup and Building",permalink:"/core/development-setup/build-environment-setup-and-building"},next:{title:"Building",permalink:"/core/development-setup/building"}},p={},s=[{value:"Using the Development Docker Image",id:"using-the-development-docker-image",level:2}],m={toc:s};function u(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("p",null,"The following is a list of prerequisites required to start developing on Oasis\nCore:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Linux (if you are not on Linux, you will need to either set up a VM with the\nproper environment or, if Docker is available for your platform, use the\nprovided Docker image which does this for you,\n",(0,r.kt)("a",{parentName:"p",href:"#using-the-development-docker-image"},"see below"),").")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"System packages:"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/projectatomic/bubblewrap"},"Bubblewrap")," (at least version 0.3.3)."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"http://gcc.gnu.org/"},"GCC")," (including C++ subpackage)."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://clang.llvm.org/"},"Clang")," development package. (If you want to build a version after v22.1.9)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/protocolbuffers/protobuf"},"Protobuf")," compiler."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.gnu.org/software/make/"},"GNU Make"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://cmake.org/"},"CMake"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.freedesktop.org/wiki/Software/pkg-config"},"pkg-config"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.openssl.org/"},"OpenSSL")," development package."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/seccomp/libseccomp"},"libseccomp")," development package.")),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("em",{parentName:"p"},"NOTE: On Ubuntu/Debian systems, compiling ",(0,r.kt)("a",{parentName:"em",href:"https://github.com/fortanix/rust-mbedtls"},"mbedtls")," crate when building the\n",(0,r.kt)("inlineCode",{parentName:"em"},"oasis-core-runtime")," binary requires having the ",(0,r.kt)("inlineCode",{parentName:"em"},"gcc-multilib")," package\ninstalled.")),(0,r.kt)("p",{parentName:"li"},"On Fedora 29+, you can install all the above with:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"sudo dnf install bubblewrap gcc gcc-c++ clang-devel protobuf-compiler make cmake openssl-devel libseccomp-devel pkg-config\n")),(0,r.kt)("p",{parentName:"li"},"On Ubuntu 18.10+ (18.04 LTS provides overly-old ",(0,r.kt)("inlineCode",{parentName:"p"},"bubblewrap"),"), you can install\nall the above with:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"sudo apt install bubblewrap gcc g++ gcc-multilib libclang-dev protobuf-compiler make cmake libssl-dev libseccomp-dev pkg-config\n"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"https://golang.org"},"Go")," (at least version 1.18.3)."),(0,r.kt)("p",{parentName:"li"},"If your distribution provides a new-enough version of Go, just use that."),(0,r.kt)("p",{parentName:"li"},"Please note that if you want to compile Oasis Core v22.1.9 or earlier,\nthen go 1.19 is not supported yet; you need to use 1.18.x."),(0,r.kt)("p",{parentName:"li"},"Otherwise:"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"install the Go version provided by your distribution,")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"https://tip.golang.org/doc/code.html#GOPATH"},"ensure ",(0,r.kt)("inlineCode",{parentName:"a"},"$GOPATH/bin")," is in your ",(0,r.kt)("inlineCode",{parentName:"a"},"PATH")),",")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"https://golang.org/doc/install#extra_versions"},"install the desired version of Go"),", e.g. 1.18.3, with:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"go install golang.org/dl/go1.18.3@latest\ngo1.18.3 download\n"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"instruct the build system to use this particular version of Go by setting\nthe ",(0,r.kt)("inlineCode",{parentName:"p"},"OASIS_GO")," environment variable in your ",(0,r.kt)("inlineCode",{parentName:"p"},"~/.bashrc"),":"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"export OASIS_GO=go1.18.3\n"))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"https://www.rust-lang.org/"},"Rust"),"."),(0,r.kt)("p",{parentName:"li"},"We follow ",(0,r.kt)("a",{parentName:"p",href:"https://www.rust-lang.org/tools/install"},"Rust upstream's recommendation")," on using\n",(0,r.kt)("a",{parentName:"p",href:"https://rustup.rs/"},"rustup")," to install and manage Rust versions."),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("em",{parentName:"p"},"NOTE: rustup cannot be installed alongside a distribution packaged Rust\nversion. You will need to remove it (if it's present) before you can start\nusing rustup.")),(0,r.kt)("p",{parentName:"li"},"Install it by running:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh\n")),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("em",{parentName:"p"},"NOTE: If you want to avoid directly executing a shell script fetched the\ninternet, you can also ",(0,r.kt)("a",{parentName:"em",href:"https://github.com/rust-lang/rustup#other-installation-methods"},"download ",(0,r.kt)("inlineCode",{parentName:"a"},"rustup-init")," executable for your platform"),"\nand run it manually.")),(0,r.kt)("p",{parentName:"li"},"This will run ",(0,r.kt)("inlineCode",{parentName:"p"},"rustup-init")," which will download and install the latest stable\nversion of Rust on your system.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"https://edp.fortanix.com"},"Fortanix Rust EDP")," utilities."),(0,r.kt)("p",{parentName:"li"},"Make sure a ",(0,r.kt)("em",{parentName:"p"},"nightly")," version of the Rust toolchain is installed:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"rustup install nightly\n")),(0,r.kt)("p",{parentName:"li"},"Then install the Fortanix Rust EDP utilities by running:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"cargo +nightly install fortanix-sgx-tools\ncargo +nightly install sgxs-tools\n")),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("em",{parentName:"p"},"NOTE: These utilities must be compiled with a nightly version of the Rust\ntoolchain since they use the ",(0,r.kt)("inlineCode",{parentName:"em"},"#![feature]")," macro."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Oasis Core's Rust toolchain version with Fortanix SGX target."),(0,r.kt)("p",{parentName:"li"},"The version of the Rust toolchain we use in Oasis Core is specified in the\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/oasisprotocol/oasis-core/tree/master/rust-toolchain.toml"},(0,r.kt)("inlineCode",{parentName:"a"},"rust-toolchain.toml"))," file."),(0,r.kt)("p",{parentName:"li"},"The rustup-installed versions of ",(0,r.kt)("inlineCode",{parentName:"p"},"cargo"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"rustc")," and other tools will\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/rust-lang/rustup/blob/master/README.md#override-precedence"},"automatically detect this file and use the appropriate version of the Rust\ntoolchain")," when invoked from the Oasis core git\ncheckout directory."),(0,r.kt)("p",{parentName:"li"},"To install the appropriate version of the Rust toolchain, make sure you are\nin an Oasis Core git checkout directory and run:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"rustup show\n")),(0,r.kt)("p",{parentName:"li"},"This will automatically install the appropriate Rust toolchain (if not\npresent) and output something similar to:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"...\n\nactive toolchain\n----------------\n\nnightly-2022-08-22-x86_64-unknown-linux-gnu (overridden by '/code/rust-toolchain.toml')\nrustc 1.65.0-nightly (c0941dfb5 2022-08-21)\n"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"(",(0,r.kt)("strong",{parentName:"p"},"OPTIONAL"),") ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/mvdan/gofumpt"},"gofumpt")," and ",(0,r.kt)("a",{parentName:"p",href:"https://pkg.go.dev/golang.org/x/tools/cmd/goimports"},"goimports"),"."),(0,r.kt)("p",{parentName:"li"},"Required if you plan to change any of the Go code in order for automated code\nformatting (",(0,r.kt)("inlineCode",{parentName:"p"},"make fmt"),") to work."),(0,r.kt)("p",{parentName:"li"},"Download and install it with:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"${OASIS_GO:-go} install mvdan.cc/gofumpt@v0.3.1\n${OASIS_GO:-go} install golang.org/x/tools/cmd/goimports@v0.1.11\n"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"(",(0,r.kt)("strong",{parentName:"p"},"OPTIONAL"),") ",(0,r.kt)("a",{parentName:"p",href:"https://golangci-lint.run/"},"golangci-lint"),"."),(0,r.kt)("p",{parentName:"li"},"Required if you plan to change any of the Go code in order for automated code\nlinting (",(0,r.kt)("inlineCode",{parentName:"p"},"make lint"),") to work."),(0,r.kt)("p",{parentName:"li"},"Download and install it with:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"curl -sSfL \\\nhttps://raw.githubusercontent.com/golangci/golangci-lint/master/install.sh \\\n | sh -s -- -b $(${OASIS_GO:-go} env GOPATH)/bin v1.41.1\n"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"(",(0,r.kt)("strong",{parentName:"p"},"OPTIONAL"),") ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/golang/protobuf"},"protoc-gen-go"),"."),(0,r.kt)("p",{parentName:"li"},"Download and install it with:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"${OASIS_GO:-go} install google.golang.org/protobuf/cmd/protoc-gen-go@v1.21.0\n")),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("em",{parentName:"p"},"NOTE: If you didn't/can't add ",(0,r.kt)("inlineCode",{parentName:"em"},"$GOPATH/bin")," to your ",(0,r.kt)("inlineCode",{parentName:"em"},"PATH"),", you can install\n",(0,r.kt)("inlineCode",{parentName:"em"},"protoc-gen-go")," to ",(0,r.kt)("inlineCode",{parentName:"em"},"/usr/local/bin")," (which is in ",(0,r.kt)("inlineCode",{parentName:"em"},"$PATH"),") with:")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"sudo GOBIN=/usr/local/bin ${OASIS_GO:-go} install google.golang.org/protobuf/cmd/protoc-gen-go@v1.21.0\n")),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("em",{parentName:"p"},"NOTE: The repository has the most up-to-date files generated by protoc-gen-go\ncommitted for convenience.  Installing protoc-gen-go is only required if you\nare a developer making changes to protobuf definitions used by Go."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"(",(0,r.kt)("strong",{parentName:"p"},"OPTIONAL"),") ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/jemalloc/jemalloc"},"jemalloc")," (version 5.2.1, built with ",(0,r.kt)("inlineCode",{parentName:"p"},"'je_'")," jemalloc-prefix)"),(0,r.kt)("p",{parentName:"li"},"Alternatively set ",(0,r.kt)("inlineCode",{parentName:"p"},'OASIS_BADGER_NO_JEMALLOC="1"')," environment variable when\nbuilding ",(0,r.kt)("inlineCode",{parentName:"p"},"oasis-node")," code, to build ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/dgraph-io/badger/"},"BadgerDB")," without ",(0,r.kt)("inlineCode",{parentName:"p"},"jemalloc")," support."),(0,r.kt)("p",{parentName:"li"},"Download and install ",(0,r.kt)("inlineCode",{parentName:"p"},"jemalloc")," with:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"JEMALLOC_VERSION=5.2.1\nJEMALLOC_CHECKSUM=34330e5ce276099e2e8950d9335db5a875689a4c6a56751ef3b1d8c537f887f6\nJEMALLOC_GITHUB=https://github.com/jemalloc/jemalloc/releases/download/\npushd $(mktemp -d)\nwget \\\n  -O jemalloc.tar.bz2 \\\n  \"${JEMALLOC_GITHUB}/${JEMALLOC_VERSION}/jemalloc-${JEMALLOC_VERSION}.tar.bz2\"\n# Ensure checksum matches.\necho \"${JEMALLOC_CHECKSUM} jemalloc.tar.bz2\" | sha256sum -c\ntar -xf jemalloc.tar.bz2\ncd jemalloc-${JEMALLOC_VERSION}\n# Ensure reproducible jemalloc build.\n# https://reproducible-builds.org/docs/build-path/\nEXTRA_CXXFLAGS=-ffile-prefix-map=$(pwd -L)=. \\\n  EXTRA_CFLAGS=-ffile-prefix-map=$(pwd -L)=. \\\n  ./configure \\\n    --with-jemalloc-prefix='je_' \\\n    --with-malloc-conf='background_thread:true,metadata_thp:auto'\nmake\nsudo make install\npopd\n")),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("em",{parentName:"p"},"NOTE: jemalloc needs to be installed to the (default) ",(0,r.kt)("inlineCode",{parentName:"em"},"/usr/local")," prefix\n(i.e. you can't use ",(0,r.kt)("inlineCode",{parentName:"em"},"./configure --prefix=$HOME/.local ..."),") because upstream\nauthors ",(0,r.kt)("a",{parentName:"em",href:"https://github.com/dgraph-io/ristretto/blob/221ca9b2091d12e5d24aa5d7d56e49745fc175d8/z/calloc_jemalloc.go#L9-L13"},"hardcode its path"),".")))),(0,r.kt)("p",null,"In the following instructions, the top-level directory is the directory\nwhere the code has been checked out."),(0,r.kt)("h2",{id:"using-the-development-docker-image"},"Using the Development Docker Image"),(0,r.kt)("p",null,"If for some reason you don't want or can't install the specified prerequisites\non the host system, you can use our development Docker image. This requires that\nyou have a ",(0,r.kt)("a",{parentName:"p",href:"https://docs.docker.com/install/"},"recent version of Docker installed"),"."),(0,r.kt)("p",null,"Oasis development environment with all the dependencies preinstalled is\navailable in the ",(0,r.kt)("inlineCode",{parentName:"p"},"oasisprotocol/oasis-core-dev:master")," image.\nTo run a container, do the following in the top-level directory:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"make docker-shell\n")),(0,r.kt)("p",null,"If you are curious, this target will internally run the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"docker run -t -i \\\n  --name oasis-core \\\n  --security-opt apparmor:unconfined \\\n  --security-opt seccomp=unconfined \\\n  -v $(pwd):/code \\\n  -w /code \\\n  oasisprotocol/oasis-core-dev:master \\\n  bash\n")),(0,r.kt)("p",null,"All the following commands can then be used from inside the container. See the\nDocker documentation for detailed instructions on working with Docker\ncontainers."))}u.isMDXComponent=!0}}]);