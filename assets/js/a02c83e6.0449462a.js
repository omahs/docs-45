"use strict";(self.webpackChunkdocs_oasis_dev=self.webpackChunkdocs_oasis_dev||[]).push([[3228],{3905:(e,n,t)=>{t.d(n,{Zo:()=>p,kt:()=>d});var a=t(7294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function s(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?s(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function r(e,n){if(null==e)return{};var t,a,o=function(e,n){if(null==e)return{};var t,a,o={},s=Object.keys(e);for(a=0;a<s.length;a++)t=s[a],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)t=s[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var c=a.createContext({}),l=function(e){var n=a.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},p=function(e){var n=l(e.components);return a.createElement(c.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,o=e.mdxType,s=e.originalType,c=e.parentName,p=r(e,["components","mdxType","originalType","parentName"]),m=l(t),d=o,h=m["".concat(c,".").concat(d)]||m[d]||u[d]||s;return t?a.createElement(h,i(i({ref:n},p),{},{components:t})):a.createElement(h,i({ref:n},p))}));function d(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var s=t.length,i=new Array(s);i[0]=m;var r={};for(var c in n)hasOwnProperty.call(n,c)&&(r[c]=n[c]);r.originalType=e,r.mdxType="string"==typeof e?e:o,i[1]=r;for(var l=2;l<s;l++)i[l]=t[l];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},1510:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>u,frontMatter:()=>s,metadata:()=>r,toc:()=>l});var a=t(7462),o=(t(7294),t(3905));const s={},i="Transactions",r={unversionedId:"core/consensus/transactions",id:"core/consensus/transactions",title:"Transactions",description:"The consensus layer uses a common transaction format for all transactions. As",source:"@site/docs/core/consensus/transactions.md",sourceDirName:"core/consensus",slug:"/core/consensus/transactions",permalink:"/core/consensus/transactions",draft:!1,editUrl:"https://github.com/oasisprotocol/oasis-core/edit/stable/22.2.x/docs/consensus/transactions.md",tags:[],version:"current",lastUpdatedAt:1669418750,formattedLastUpdatedAt:"Nov 25, 2022",frontMatter:{},sidebar:"oasisCore",previous:{title:"Consensus Layer",permalink:"/core/consensus/"},next:{title:"Services",permalink:"/core/consensus/services"}},c={},l=[{value:"Format",id:"format",level:2},{value:"Fees",id:"fees",level:2},{value:"Gas",id:"gas",level:3},{value:"Gas Estimation",id:"gas-estimation",level:2},{value:"Submission",id:"submission",level:2}],p={toc:l};function u(e){let{components:n,...t}=e;return(0,o.kt)("wrapper",(0,a.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"transactions"},"Transactions"),(0,o.kt)("p",null,"The consensus layer uses a common transaction format for all transactions. As\nwith other Oasis Core components, it tries to be independent of any concrete\n",(0,o.kt)("a",{parentName:"p",href:"/core/consensus/"},"consensus backend"),"."),(0,o.kt)("p",null,"The transaction API definitions and helper methods for creating and verifying\ntransactions lives in ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/oasisprotocol/oasis-core/tree/master/go/consensus/api/transaction/transaction.go"},(0,o.kt)("inlineCode",{parentName:"a"},"go/consensus/api/transaction")),". For more information\nyou can also check out the ",(0,o.kt)("a",{parentName:"p",href:"https://pkg.go.dev/github.com/oasisprotocol/oasis-core/go/consensus/api/transaction?tab=doc"},"consensus backend API documentation"),"."),(0,o.kt)("h2",{id:"format"},"Format"),(0,o.kt)("p",null,"Each (unsigned) transaction is represented by the following ",(0,o.kt)("a",{parentName:"p",href:"/core/encoding"},"encoded")," structure:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-golang"},'type Transaction struct {\n    Nonce uint64 `json:"nonce"`\n    Fee   *Fee   `json:"fee,omitempty"`\n\n    Method string      `json:"method"`\n    Body   interface{} `json:"body,omitempty"`\n}\n')),(0,o.kt)("p",null,"Fields:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"nonce")," is the current caller's nonce to prevent replays."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"fee")," is an optional fee that the caller commits to paying to execute the\ntransaction."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"method")," is the called method name. Method names are composed of two parts,\nthe component name and the method name, joined by a separator (",(0,o.kt)("inlineCode",{parentName:"li"},"."),"). For\nexample, ",(0,o.kt)("inlineCode",{parentName:"li"},"staking.Transfer")," is the method name of the staking service's\n",(0,o.kt)("inlineCode",{parentName:"li"},"Transfer")," method."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"body")," is the method-specific body.")),(0,o.kt)("p",null,"The actual transaction that is submitted to the consensus layer must be signed\nwhich means that it is wrapped into a ",(0,o.kt)("a",{parentName:"p",href:"/core/crypto#signed-envelope"},"signed envelope"),"."),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"/core/crypto#domain-separation"},"Domain separation")," context (+ ",(0,o.kt)("a",{parentName:"p",href:"/core/crypto#chain-domain-separation"},"chain domain separation"),"):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"oasis-core/consensus: tx\n")),(0,o.kt)("h2",{id:"fees"},"Fees"),(0,o.kt)("p",null,"As the consensus operations require resources to process, the consensus layer\ncharges fees to perform operations."),(0,o.kt)("h3",{id:"gas"},"Gas"),(0,o.kt)("p",null,"Gas is an unsigned 64-bit integer denominated in ",(0,o.kt)("em",{parentName:"p"},"gas units"),"."),(0,o.kt)("p",null,"Different operations cost different amounts of gas as defined by the consensus\nparameters of the consensus component that implements the operation."),(0,o.kt)("p",null,"Transactions that require fees to process will include a ",(0,o.kt)("inlineCode",{parentName:"p"},"fee")," field to declare\nhow much the caller is willing to pay for fees.\nSpecifying an ",(0,o.kt)("inlineCode",{parentName:"p"},"amount")," (in base units) and ",(0,o.kt)("inlineCode",{parentName:"p"},"gas")," (in gas units) implicitly\ndefines a ",(0,o.kt)("em",{parentName:"p"},"gas price")," (price of one gas unit) as ",(0,o.kt)("inlineCode",{parentName:"p"},"amount / gas"),".\nConsensus validators may refuse to process operations with a gas price that is\ntoo low."),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"gas")," field defines the maximum amount of gas that can be used by an\noperation for which the fee has been included. In case an operation uses more\ngas, processing will be aborted and no state changes will take place."),(0,o.kt)("p",null,"Signing a transaction which includes a fee structure implicitly grants\npermission to withdraw the given amount of base units from the signer's account.\nIn case there is not enough balance in the account, the operation will fail."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-golang"},'type Fee struct {\n    Amount quantity.Quantity `json:"amount"`\n    Gas    Gas               `json:"gas"`\n}\n')),(0,o.kt)("p",null,"Fees are not refunded."),(0,o.kt)("p",null,"Fields:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"amount")," is the total fee amount (in base units) to be paid."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"gas")," is the maximum gas that an operation can use.")),(0,o.kt)("h2",{id:"gas-estimation"},"Gas Estimation"),(0,o.kt)("p",null,"As transactions need to provide the maximum amount of gas that can be consumed\nduring their execution, the caller may need to be able to estimate the amount of\ngas needed. In order to do that the consensus backend API includes a method\ncalled ",(0,o.kt)("a",{parentName:"p",href:"https://pkg.go.dev/github.com/oasisprotocol/oasis-core/go/consensus/api?tab=doc#ClientBackend.EstimateGas"},(0,o.kt)("inlineCode",{parentName:"a"},"EstimateGas"))," for estimating gas."),(0,o.kt)("p",null,"The implementation of gas estimation is ",(0,o.kt)("a",{parentName:"p",href:"/core/consensus/"},"backend-specific")," but usually involves\nsome kind of simulation of transaction execution to derive the maximum amount\nconsumed by execution."),(0,o.kt)("h2",{id:"submission"},"Submission"),(0,o.kt)("p",null,"Transactions can be submitted to the consensus layer by calling ",(0,o.kt)("a",{parentName:"p",href:"https://pkg.go.dev/github.com/oasisprotocol/oasis-core/go/consensus/api?tab=doc#ClientBackend.SubmitTx"},(0,o.kt)("inlineCode",{parentName:"a"},"SubmitTx"))," and\nproviding a signed transaction."),(0,o.kt)("p",null,"The consensus backend API provides a submission manager for cases where the\n",(0,o.kt)("a",{parentName:"p",href:"/core/crypto"},"signer")," is available and automatic gas estimation and nonce lookup is desired.\nIt is available via the ",(0,o.kt)("a",{parentName:"p",href:"https://pkg.go.dev/github.com/oasisprotocol/oasis-core/go/consensus/api?tab=doc#SignAndSubmitTx"},(0,o.kt)("inlineCode",{parentName:"a"},"SignAndSubmitTx"))," function."))}u.isMDXComponent=!0}}]);