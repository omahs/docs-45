"use strict";(self.webpackChunkdocs_oasis_dev=self.webpackChunkdocs_oasis_dev||[]).push([[6466],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>c});var r=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function d(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var s=r.createContext({}),l=function(e){var n=r.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},u=function(e){var n=l(e.components);return r.createElement(s.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},m=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,u=d(e,["components","mdxType","originalType","parentName"]),m=l(t),c=a,h=m["".concat(s,".").concat(c)]||m[c]||p[c]||i;return t?r.createElement(h,o(o({ref:n},u),{},{components:t})):r.createElement(h,o({ref:n},u))}));function c(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var i=t.length,o=new Array(i);o[0]=m;var d={};for(var s in n)hasOwnProperty.call(n,s)&&(d[s]=n[s]);d.originalType=e,d.mdxType="string"==typeof e?e:a,o[1]=d;for(var l=2;l<i;l++)o[l]=t[l];return r.createElement.apply(null,o)}return r.createElement.apply(null,t)}m.displayName="MDXCreateElement"},2647:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>o,default:()=>p,frontMatter:()=>i,metadata:()=>d,toc:()=>l});var r=t(7462),a=(t(7294),t(3905));const i={},o="Key Manager Node",d={unversionedId:"node/run-your-node/keymanager-node/README",id:"node/run-your-node/keymanager-node/README",title:"Key Manager Node",description:"These instructions are for setting up a key manager node. Key manager nodes run a special runtime that provides confidentiality to other ParaTimes. If you want to run a validator node instead, see the instructions for running a validator node. Similarly, if you want to run a ParaTime node instead, see the instructions for running a ParaTime node.",source:"@site/docs/node/run-your-node/keymanager-node/README.md",sourceDirName:"node/run-your-node/keymanager-node",slug:"/node/run-your-node/keymanager-node/",permalink:"/node/run-your-node/keymanager-node/",draft:!1,editUrl:"https://github.com/oasisprotocol/docs/edit/main/docs/node/run-your-node/keymanager-node/README.md",tags:[],version:"current",lastUpdatedAt:1675933402,formattedLastUpdatedAt:"Feb 9, 2023",frontMatter:{},sidebar:"operators",previous:{title:"ParaTime Client Node",permalink:"/node/run-your-node/paratime-client-node"},next:{title:"Signing Key Manager Policy",permalink:"/node/run-your-node/keymanager-node/signing-key-manager-policy"}},s={},l=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Setting up Trusted Execution Environment (TEE)",id:"setting-up-trusted-execution-environment-tee",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Starting the Oasis Node",id:"starting-the-oasis-node",level:2},{value:"Checking Node Status",id:"checking-node-status",level:2}],u={toc:l};function p(e){let{components:n,...t}=e;return(0,a.kt)("wrapper",(0,r.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"key-manager-node"},"Key Manager Node"),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},"These instructions are for setting up a ",(0,a.kt)("em",{parentName:"p"},"key manager")," node. Key manager nodes run a special runtime that provides confidentiality to other ParaTimes. If you want to run a ",(0,a.kt)("em",{parentName:"p"},"validator")," node instead, see the ",(0,a.kt)("a",{parentName:"p",href:"/node/run-your-node/validator-node/"},"instructions for running a validator node"),". Similarly, if you want to run a ",(0,a.kt)("em",{parentName:"p"},"ParaTime")," node instead, see the ",(0,a.kt)("a",{parentName:"p",href:"/node/run-your-node/paratime-node"},"instructions for running a ParaTime node"),".")),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"At time of writing the key manager ParaTime is deployed only on the Testnet to support Cipher and Sapphire ParaTimes, and limited to be run by trustworthy partners.")),(0,a.kt)("p",null,"This guide will cover setting up your key manager node for the Oasis Network. This guide assumes some basic knowledge on the use of command line tools."),(0,a.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,a.kt)("p",null,"Before following this guide, make sure you've followed the ",(0,a.kt)("a",{parentName:"p",href:"../prerequisites"},"Prerequisites")," and ",(0,a.kt)("a",{parentName:"p",href:"/node/run-your-node/non-validator-node"},"Run a Non-validator Node")," sections and have:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Oasis Node binary installed on your system and a dedicated non-root user that will run your Oasis Node."),(0,a.kt)("li",{parentName:"ul"},"The chosen top-level ",(0,a.kt)("inlineCode",{parentName:"li"},"/node/")," working directory prepared (feel free to name it as you wish, e.g. ",(0,a.kt)("inlineCode",{parentName:"li"},"/srv/oasis/"),") with:",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"etc"),": This will store the node configuration and genesis file."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"data"),": This will store the data directory needed by Oasis Node, including your node identity and the blockchain state. The directory permissions should be ",(0,a.kt)("inlineCode",{parentName:"li"},"rwx------"),"."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"bin"),": This will store binaries needed by Oasis Node for running the ParaTimes."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"runtimes"),": This will store the ParaTime bundles."))),(0,a.kt)("li",{parentName:"ul"},"Downloaded or compiled the correct versions of everything according to ",(0,a.kt)("a",{parentName:"li",href:"/node/mainnet/"},"Mainnet Network Parameters"),":",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"The genesis file copied to ",(0,a.kt)("inlineCode",{parentName:"li"},"/node/etc/genesis.json"),"."),(0,a.kt)("li",{parentName:"ul"},"The binaries needed by Oasis Node for running the ParaTimes copied to ",(0,a.kt)("inlineCode",{parentName:"li"},"/node/bin/"),"."),(0,a.kt)("li",{parentName:"ul"},"The key manager ParaTime bundle (",(0,a.kt)("inlineCode",{parentName:"li"},".orc")," extension) copied to ",(0,a.kt)("inlineCode",{parentName:"li"},"/node/runtimes/"),"."))),(0,a.kt)("li",{parentName:"ul"},"Initialized a new node and updated your entity registration by following the ",(0,a.kt)("a",{parentName:"li",href:"/node/run-your-node/paratime-node#register-a-new-entity-or-update-your-entity-registration"},"Register a New Entity or Update Your Entity Registration")," instructions.",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"The entity descriptor file copied to ",(0,a.kt)("inlineCode",{parentName:"li"},"/node/etc/entity.json"),".")))),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"Reading the rest of the ",(0,a.kt)("a",{parentName:"p",href:"/node/run-your-node/validator-node/"},"validator node setup instructions")," and ",(0,a.kt)("a",{parentName:"p",href:"/node/run-your-node/paratime-node"},"ParaTime node setup instructions")," may also be useful.")),(0,a.kt)("h3",{id:"setting-up-trusted-execution-environment-tee"},"Setting up Trusted Execution Environment (TEE)"),(0,a.kt)("p",null,"The key manager ParaTime requires the use of a TEE. See the ",(0,a.kt)("a",{parentName:"p",href:"/node/run-your-node/prerequisites/set-up-trusted-execution-environment-tee"},"Set up Trusted Execution Environment (TEE)")," doc for instructions on how to set it up before proceeding."),(0,a.kt)("h2",{id:"configuration"},"Configuration"),(0,a.kt)("p",null,"In order to configure the node create the ",(0,a.kt)("inlineCode",{parentName:"p"},"/node/etc/config.yml")," file with the following content:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'datadir: /node/data\n\nlog:\n  level:\n    default: info\n    tendermint: info\n    tendermint/context: error\n  format: JSON\n\ngenesis:\n  file: /node/etc/genesis.json\n\nconsensus:\n  tendermint:\n    core:\n      listen_address: tcp://0.0.0.0:26656\n\n      # The external IP that is used when registering this node to the network.\n      # NOTE: If you are using the Sentry node setup, this option should be\n      # omitted.\n      external_address: tcp://{{ external_address }}:26656\n\n    p2p:\n      # List of seed nodes to connect to.\n      # NOTE: You can add additional seed nodes to this list if you want.\n      seed:\n        - "{{ seed_node_address }}"\n\nruntime:\n  mode: keymanager\n  paths:\n    # Path to the key manager ParaTime bundle.\n    - "{{ keymanager_runtime_orc_path }}"\n\n  # The following section is required for ParaTimes which are running inside the\n  # Intel SGX Trusted Execution Environment.\n  sgx:\n    loader: /node/bin/oasis-core-runtime-loader\n\nworker:\n  registration:\n    # In order for the node to register itself, the entity.json of the entity\n    # used to provision the node must be available on the node.\n    entity: /node/etc/entity.json\n\n  keymanager:\n    runtime:\n      id: "{{ keymanager_runtime_id }}"\n\n  p2p:\n    # External P2P configuration.\n    port: 20104\n    addresses:\n      # The external IP that is used when registering this node to the network.\n      - "{{ external_address }}:20104"\n\n# The following section is required for ParaTimes which are running inside the\n# Intel SGX Trusted Execution Environment.\nias:\n  proxy:\n    address:\n      # List of IAS proxies to connect to.\n      # NOTE: You can add additional IAS proxies to this list if you want.\n      - "{{ ias_proxy_address }}"\n')),(0,a.kt)("p",null,"Before using this configuration you should collect the following information to replace the ",(0,a.kt)("inlineCode",{parentName:"p"},"{{ ... }}")," variables present in the configuration file:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"{{ external_address }}"),": The external IP you used when registering this node."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"{{ seed_node_address }}"),": The seed node address in the form ",(0,a.kt)("inlineCode",{parentName:"li"},"ID@IP:port"),".",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"You can find the current Oasis Seed Node address in the ",(0,a.kt)("a",{parentName:"li",href:"/node/mainnet/"},"Network Parameters"),"."))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"{{ keymanager_runtime_orc_path }}"),": Path to the key manager ",(0,a.kt)("a",{parentName:"li",href:"/node/run-your-node/paratime-node#the-paratime-bundle"},"ParaTime bundle")," of the form ",(0,a.kt)("inlineCode",{parentName:"li"},"/node/runtimes/foo-paratime.orc"),".",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"You can find the current Oasis-supported key manager ParaTime in the ",(0,a.kt)("a",{parentName:"li",href:"/node/mainnet/#paratimes"},"Mainnet Network Paramers"),"."))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"{{ keymanager_runtime_id }}"),": Runtime identified for the key manager ParaTime.",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"You can find the current Oasis-supported key manager ParaTime identifiers in the ",(0,a.kt)("a",{parentName:"li",href:"/node/mainnet/#paratimes"},"Mainnet Network Paramers"),"."))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"{{ ias_proxy_address }}"),": The IAS proxy address in the form ",(0,a.kt)("inlineCode",{parentName:"li"},"ID@HOST:port"),".",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"You can find the current Oasis IAS proxy address in the ",(0,a.kt)("a",{parentName:"li",href:"/node/mainnet/#cipher-paratime"},"Mainnet Network Parameters"),"."),(0,a.kt)("li",{parentName:"ul"},"If you want, you can also ",(0,a.kt)("a",{parentName:"li",href:"/node/run-your-node/ias-proxy"},"run your own IAS proxy"),".")))),(0,a.kt)("admonition",{type:"caution"},(0,a.kt)("p",{parentName:"admonition"},"Make sure the ",(0,a.kt)("inlineCode",{parentName:"p"},"worker.p2p.port")," (default: ",(0,a.kt)("inlineCode",{parentName:"p"},"9200"),") port is exposed and publicly\naccessible on the internet (for ",(0,a.kt)("inlineCode",{parentName:"p"},"TCP")," traffic).")),(0,a.kt)("h2",{id:"starting-the-oasis-node"},"Starting the Oasis Node"),(0,a.kt)("p",null,"You can start the node by running the following command:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"oasis-node --config /node/etc/config.yml\n")),(0,a.kt)("h2",{id:"checking-node-status"},"Checking Node Status"),(0,a.kt)("p",null,"To ensure that your node is properly connected with the network, you can run the following command after the node has started:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"oasis-node control status -a unix:/node/data/internal.sock\n")))}p.isMDXComponent=!0}}]);