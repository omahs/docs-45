"use strict";(self.webpackChunkdocs_oasis_dev=self.webpackChunkdocs_oasis_dev||[]).push([[1889],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>u});var r=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var d=r.createContext({}),l=function(e){var t=r.useContext(d),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},c=function(e){var t=l(e.components);return r.createElement(d.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},p=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,d=e.parentName,c=a(e,["components","mdxType","originalType","parentName"]),p=l(n),u=i,g=p["".concat(d,".").concat(u)]||p[u]||m[u]||o;return n?r.createElement(g,s(s({ref:t},c),{},{components:n})):r.createElement(g,s({ref:t},c))}));function u(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,s=new Array(o);s[0]=p;var a={};for(var d in t)hasOwnProperty.call(t,d)&&(a[d]=t[d]);a.originalType=e,a.mdxType="string"==typeof e?e:i,s[1]=a;for(var l=2;l<o;l++)s[l]=n[l];return r.createElement.apply(null,s)}return r.createElement.apply(null,n)}p.displayName="MDXCreateElement"},339:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>s,default:()=>m,frontMatter:()=>o,metadata:()=>a,toc:()=>l});var r=n(7462),i=(n(7294),n(3905));const o={},s="Using Ledger-backed Consensus Key with a Remote Signer",a={unversionedId:"node/run-your-node/advanced/using-ledger-backed-consensus-key-with-a-remote-signer",id:"node/run-your-node/advanced/using-ledger-backed-consensus-key-with-a-remote-signer",title:"Using Ledger-backed Consensus Key with a Remote Signer",description:"This guide will describe how you can set up your validator node with a detached consensus key stored on a Ledger wallet connected via Oasis Core's Remote Signer.",source:"@site/docs/node/run-your-node/advanced/using-ledger-backed-consensus-key-with-a-remote-signer.md",sourceDirName:"node/run-your-node/advanced",slug:"/node/run-your-node/advanced/using-ledger-backed-consensus-key-with-a-remote-signer",permalink:"/node/run-your-node/advanced/using-ledger-backed-consensus-key-with-a-remote-signer",draft:!1,editUrl:"https://github.com/oasisprotocol/docs/edit/main/docs/node/run-your-node/advanced/using-ledger-backed-consensus-key-with-a-remote-signer.md",tags:[],version:"current",lastUpdatedAt:1675933402,formattedLastUpdatedAt:"Feb 9, 2023",frontMatter:{},sidebar:"operators",previous:{title:"Install Oasis Remote Signer Binary",permalink:"/node/run-your-node/advanced/install-oasis-remote-signer-binary"},next:{title:"Troubleshooting",permalink:"/node/run-your-node/troubleshooting"}},d={},l=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Set Up Remote Signer System",id:"set-up-remote-signer-system",level:2},{value:"Initialize Remote Signer",id:"initialize-remote-signer",level:3},{value:"Run Remote Signer",id:"run-remote-signer",level:3},{value:"Copy Remote Signer Certificate and Client Key and Certificate",id:"copy-remote-signer-certificate-and-client-key-and-certificate",level:3},{value:"Set Up Oasis Node System",id:"set-up-oasis-node-system",level:2},{value:"Initialize Oasis Node",id:"initialize-oasis-node",level:3},{value:"Configure Oasis Node",id:"configure-oasis-node",level:3}],c={toc:l};function m(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"using-ledger-backed-consensus-key-with-a-remote-signer"},"Using Ledger-backed Consensus Key with a Remote Signer"),(0,i.kt)("p",null,"This guide will describe how you can set up your ",(0,i.kt)("a",{parentName:"p",href:"/node/run-your-node/validator-node/"},(0,i.kt)("em",{parentName:"a"},"validator")," node")," with a detached consensus key stored on a ",(0,i.kt)("a",{parentName:"p",href:"https://www.ledger.com"},"Ledger")," wallet connected via ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/oasisprotocol/oasis-core/tree/master/go/oasis-remote-signer"},"Oasis Core's Remote Signer"),"."),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"These instructions are still a work-in-progress draft."),(0,i.kt)("p",{parentName:"admonition"},"Your feedback is welcome. Please, reach out via the ",(0,i.kt)("a",{parentName:"p",href:"/get-involved/"},(0,i.kt)("strong",{parentName:"a"},"#node-operators")," channel at the Oasis Network Community server on Discord")," with your questions, comments, and feedback.")),(0,i.kt)("admonition",{type:"danger"},(0,i.kt)("p",{parentName:"admonition"},"These are advanced instructions intended for node operators that want to increase their validator node security by having the consensus key be detached and stored on a Ledger wallet and connected via Oasis Core's remote signer instead of having consensus key simply be a file on the file system.")),(0,i.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,i.kt)("p",null,"Before following this guide, make sure you've followed the ",(0,i.kt)("a",{parentName:"p",href:"../prerequisites"},"Prerequisites")," section and have the Oasis Node binary installed on your Oasis node system."),(0,i.kt)("p",null,"Also make sure you've followed the ",(0,i.kt)("a",{parentName:"p",href:"/node/run-your-node/advanced/install-oasis-remote-signer-binary"},"Install Oasis Remote Signer Binary")," section and have the Oasis Remote Signer binary installed on your remote signer system where your Ledger wallet will be connected."),(0,i.kt)("p",null,"Finally, you need to do steps described in the ",(0,i.kt)("a",{parentName:"p",href:"/oasis-core-ledger/usage/setup"},"Setup")," section of our ",(0,i.kt)("a",{parentName:"p",href:"../../../oasis-core-ledger"},"Oasis Core Ledger docs"),". Make sure you also install the ",(0,i.kt)("em",{parentName:"p"},(0,i.kt)("strong",{parentName:"em"},"OasisVal")),(0,i.kt)("strong",{parentName:"p"}," app")," on your Ledger wallet."),(0,i.kt)("h2",{id:"set-up-remote-signer-system"},"Set Up Remote Signer System"),(0,i.kt)("h3",{id:"initialize-remote-signer"},"Initialize Remote Signer"),(0,i.kt)("p",null,"On your remote signer system, create a directory for the remote signer, e.g. ",(0,i.kt)("inlineCode",{parentName:"p"},"remote-signer"),", by running:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"mkdir --mode=700 remote-signer\n")),(0,i.kt)("p",null,"Then initialize remote signer's keys (consensus, entity, identity, ...) and server certificate by running:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"oasis-remote-signer init --datadir remote-signer/\n")),(0,i.kt)("p",null,"Also initialize remote signer's client certificate which will be used by the Oasis node system to connect to the remote signer system:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"oasis-remote-signer init_client --datadir remote-signer/\n")),(0,i.kt)("h3",{id:"run-remote-signer"},"Run Remote Signer"),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"Before following the instructions below, make sure your Ledger wallet is connected to your remote signer system, unlocked and the OasisVal App is open.")),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"While the OasisVal App is available in ",(0,i.kt)("em",{parentName:"p"},"Developer mode"),', opening the App brings up the "Pending Ledger review" screen. You need to press both buttons at once to close that screen and transition to the ',(0,i.kt)("em",{parentName:"p"},"ordinary"),' "Oasis Ready" screen where the OasisVal App is ready to be used.')),(0,i.kt)("p",null,"Choose the gRPC port on which the remote signer will listen for client requests and set the path to the ",(0,i.kt)("inlineCode",{parentName:"p"},"ledger-signer")," plugin in the appropriate environment variables and run:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"GRPC_PORT=<REMOTE-SIGNER-PORT>\nLEDGER_SIGNER_PATH=<PATH-TO-LEDGER-SIGNER-PLUGIN>\noasis-remote-signer \\\n--datadir remote-signer \\\n--signer.backend composite \\\n--signer.composite.backends entity:file,node:file,p2p:file,consensus:plugin \\\n--signer.plugin.name ledger \\\n--signer.plugin.path $LEDGER_SIGNER_PATH \\\n--client.certificate remote-signer/remote_signer_client_cert.pem \\\n--grpc.port $GRPC_PORT \\\n--log.level DEBUG\n")),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"If necessary, you can configure the Ledger-based signer by setting the ",(0,i.kt)("inlineCode",{parentName:"p"},"--signer.plugin.config")," flag appropriately, e.g.:"),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre"},'--signer.plugin.config "wallet_id:1fc3be,index:5"\n')),(0,i.kt)("p",{parentName:"admonition"},"to configure the wallet with a specific ID and to use a non-zero account index.")),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"The Oasis Remote Signer is configured to run in the foreground by default."),(0,i.kt)("p",{parentName:"admonition"},"We recommend you configure and use it with a process manager like ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/systemd/systemd"},"systemd")," or ",(0,i.kt)("a",{parentName:"p",href:"http://supervisord.org"},"Supervisor"),".")),(0,i.kt)("h3",{id:"copy-remote-signer-certificate-and-client-key-and-certificate"},"Copy Remote Signer Certificate and Client Key and Certificate"),(0,i.kt)("p",null,"For the Oasis node system to be able to connect to the Oasis Remote Signer on the remote signer system and to be able to demonstrate its authenticity to it, you need to copy the following files from your remote signer system to your Oasis node system:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"remote-signer/remote_signer_server_cert.pem"),": The remote signer's certificate. This certificate ensures the Oasis node system is connecting to the trusted remote signer system."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"remote-signer/remote_signer_client_key.pem"),": The remote signer's client key. This key enables the Oasis node system to demonstrate its authenticity when it is requesting signatures from the remote signer system."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"remote-signer/remote_signer_client_cert.pem"),": The remote signer's client certificate. This certificate is the counterpart of the remote signer's client key.")),(0,i.kt)("h2",{id:"set-up-oasis-node-system"},"Set Up Oasis Node System"),(0,i.kt)("p",null,"For setting up your Oasis Node system, follow the ",(0,i.kt)("a",{parentName:"p",href:"/node/run-your-node/validator-node/"},"Run a Validator Node")," docs."),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"Make sure you've copied the remote signer's certificate and remote signer's client key and certificate to your Oasis Node system as described in ",(0,i.kt)("a",{parentName:"p",href:"/node/run-your-node/advanced/using-ledger-backed-consensus-key-with-a-remote-signer#copy-remote-signer-certificate-and-client-key-and-certificate"},"Copy Remote Signer Certificate and Client Key and Certificate")," section.")),(0,i.kt)("h3",{id:"initialize-oasis-node"},"Initialize Oasis Node"),(0,i.kt)("p",null,"When ",(0,i.kt)("a",{parentName:"p",href:"/node/run-your-node/validator-node/#initializing-a-node"},"initializing your Oasis node"),", you need to pass appropriate ",(0,i.kt)("inlineCode",{parentName:"p"},"--signer.*")," flags to configure the composite and remote signers. For example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"ENTITY_DIR=<YOUR-ENTITY-DIR>\nSTATIC_IP=<YOUR-STATIC-IP>\nREMOTE_SIGNER_IP=<YOUR-REMOTE-SIGNER-IP>\nREMOTE_SIGNER_PORT=<YOUR-REMOTE-SIGNER-PORT>\noasis-node registry node init \\\n--signer.backend composite \\\n--signer.composite.backends 1:file,2:file,3:file,4:remote \\\n--signer.dir $ENTITY_DIR \\\n--node.consensus_address $STATIC_IP:26656 \\\n--node.role validator \\\n--signer.remote.address $REMOTE_SIGNER_IP:$REMOTE_SIGNER_PORT \\\n--signer.remote.client.certificate remote-signer/remote_signer_client_cert.pem \\\n--signer.remote.client.key remote-signer/remote_signer_client_key.pem \\\n--signer.remote.server.certificate remote-signer/remote_signer_server_cert.pem \\\n--datadir node/\n")),(0,i.kt)("p",null,"This assumes you've copied the remote signer's certificate and remote signer's client key and certificate to the ",(0,i.kt)("inlineCode",{parentName:"p"},"remote-signer/")," directory."),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"The resulting directory only has ",(0,i.kt)("inlineCode",{parentName:"p"},"consensus_pub.pem")," and no ",(0,i.kt)("inlineCode",{parentName:"p"},"consensus.pem")," since the consensus key is Ledger-backed.")),(0,i.kt)("h3",{id:"configure-oasis-node"},"Configure Oasis Node"),(0,i.kt)("p",null,"When ",(0,i.kt)("a",{parentName:"p",href:"/node/run-your-node/validator-node/#configuring-the-oasis-node"},"configuring your Oasis Node"),", you need to add the appropriate ",(0,i.kt)("inlineCode",{parentName:"p"},"signer")," section to configure the composite and remote signers. For example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"# Signer.\nsigner:\n  backend: composite\n  # Use file-based signer for entity, node and P2P keys and remote signer for the\n  # consensus key.\n  composite:\n    backends: entity:file,node:file,p2p:file,consensus:remote\n  # Configure how to connect to the Oasis Remote Signer.\n  remote:\n    address: <YOUR-REMOTE-SIGNER-IP>:<YOUR-REMOTE-SIGNER-PORT>\n    server:\n      certificate: /srv/oasis/remote-signer/remote_signer_server_cert.pem\n    client:\n      key: /srv/oasis/remote-signer/remote_signer_client_key.pem\n      certificate: /srv/oasis/remote-signer/remote_signer_client_cert.pem\n")),(0,i.kt)("p",null,"This assumes you've copied the remote signer's certificate and remote signer's client key and certificate to the ",(0,i.kt)("inlineCode",{parentName:"p"},"/srv/oasis/remote-signer/")," directory."),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"To ensure your Oasis Node will be able to sign consensus transactions, make sure your Ledger wallet is connected to your remote signer system, unlocked and the OasisVal App is open."),(0,i.kt)("p",{parentName:"admonition"},"Also make sure the Oasis Remote Signer is running on your remote signer system and accepting remote client connections via the designated port.")))}m.isMDXComponent=!0}}]);