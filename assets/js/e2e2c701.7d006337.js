"use strict";(self.webpackChunkdocs_oasis_dev=self.webpackChunkdocs_oasis_dev||[]).push([[9116],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=a.createContext({}),l=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=l(e.components);return a.createElement(c.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,c=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=l(n),m=r,y=u["".concat(c,".").concat(m)]||u[m]||d[m]||o;return n?a.createElement(y,i(i({ref:t},p),{},{components:n})):a.createElement(y,i({ref:t},p))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=u;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var l=2;l<o;l++)i[l]=n[l];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},4723:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>l});var a=n(7462),r=(n(7294),n(3905));const o={},i="Key Manager",s={unversionedId:"core/consensus/services/keymanager",id:"core/consensus/services/keymanager",title:"Key Manager",description:"The key manager service is responsible for coordinating the SGX-based key",source:"@site/docs/core/consensus/services/keymanager.md",sourceDirName:"core/consensus/services",slug:"/core/consensus/services/keymanager",permalink:"/core/consensus/services/keymanager",draft:!1,editUrl:"https://github.com/oasisprotocol/oasis-core/edit/stable/22.2.x/docs/consensus/services/keymanager.md",tags:[],version:"current",lastUpdatedAt:1669418750,formattedLastUpdatedAt:"Nov 25, 2022",frontMatter:{},sidebar:"oasisCore",previous:{title:"Root Hash",permalink:"/core/consensus/services/roothash"},next:{title:"Genesis Document",permalink:"/core/consensus/genesis"}},c={},l=[{value:"Policies",id:"policies",level:2},{value:"Methods",id:"methods",level:2},{value:"Update Policy",id:"update-policy",level:3},{value:"Events",id:"events",level:2}],p={toc:l};function d(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"key-manager"},"Key Manager"),(0,r.kt)("p",null,"The key manager service is responsible for coordinating the SGX-based key\nmanager runtimes. It stores and publishes policy documents and status updates\nrequired for key manager replication."),(0,r.kt)("p",null,"The service interface definition lives in ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/oasisprotocol/oasis-core/tree/master/go/keymanager/api"},(0,r.kt)("inlineCode",{parentName:"a"},"go/keymanager/api")),". It defines the\nsupported queries and transactions. For more information you can also check out\nthe ",(0,r.kt)("a",{parentName:"p",href:"https://pkg.go.dev/github.com/oasisprotocol/oasis-core/go/keymanager/api?tab=doc"},"consensus service API documentation"),"."),(0,r.kt)("h2",{id:"policies"},"Policies"),(0,r.kt)("p",null,"A key manager policy document defines the policy that key manager\nimplementations use to enforce access control to key material. At this point the\npolicy document is specifically designed to work with our Intel SGX-based key\nmanager runtime."),(0,r.kt)("p",null,"The ",(0,r.kt)("a",{parentName:"p",href:"https://pkg.go.dev/github.com/oasisprotocol/oasis-core/go/keymanager/api?tab=doc#PolicySGX"},"policy document")," specifies the following access control policies that are\nenforced by the key manager runtime based on the calling enclave identity:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Enclaves that may query private keys.")," These are usually enclave identities\nof confidential runtimes that need access to per-runtime private keys to\ndecrypt state.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Enclaves that may replicate the master secret.")," These are usually enclave\nidentities of new key manager enclave versions, to support upgrades. Own\nenclave identity is implied (to allow key manager replication) and does not\nneed to be explicitly specified."))),(0,r.kt)("p",null,"In order for the policy to be valid and accepted by a key manager enclave it\nmust be signed by a configured threshold of keys. Both the threshold and the\nauthorized public keys that can sign the policy are hardcoded in the key manager\nenclave."),(0,r.kt)("h2",{id:"methods"},"Methods"),(0,r.kt)("h3",{id:"update-policy"},"Update Policy"),(0,r.kt)("p",null,"Policy update enables the key manager runtime owning entity to update the\ncurrent key manager policy. A new update policy transaction can be generated\nusing ",(0,r.kt)("a",{parentName:"p",href:"https://pkg.go.dev/github.com/oasisprotocol/oasis-core/go/keymanager/api?tab=doc#NewUpdatePolicyTx"},(0,r.kt)("inlineCode",{parentName:"a"},"NewUpdatePolicyTx")),"."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Method name:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"keymanager.UpdatePolicy\n")),(0,r.kt)("p",null,"The body of an update policy transaction must be a ",(0,r.kt)("a",{parentName:"p",href:"https://pkg.go.dev/github.com/oasisprotocol/oasis-core/go/keymanager/api?tab=doc#SignedPolicySGX"},(0,r.kt)("inlineCode",{parentName:"a"},"SignedPolicySGX"))," which is\na signed key manager access control policy. The signer of the transaction must\nbe the key manager runtime's owning entity."),(0,r.kt)("h2",{id:"events"},"Events"))}d.isMDXComponent=!0}}]);